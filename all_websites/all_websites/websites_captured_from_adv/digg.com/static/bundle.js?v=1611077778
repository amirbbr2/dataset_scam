const enableDiggAds=()=>{localStorage.removeItem("disable-digg-ads"),window.location.reload()},disableDiggAds=()=>{localStorage.setItem("disable-digg-ads",!0),window.location.reload()};!function(){if("undefined"!=typeof window)try{const e=new window.CustomEvent("test",{cancelable:!0});if(e.preventDefault(),!0!==e.defaultPrevented)throw new Error("Could not prevent default")}catch(e){const t=function(e,t){let i,n;return t=t||{bubbles:!1,cancelable:!1,detail:void 0},i=document.createEvent("CustomEvent"),i.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n=i.preventDefault,i.preventDefault=function(){n.call(this);try{Object.defineProperty(this,"defaultPrevented",{get:()=>!0})}catch(e){this.defaultPrevented=!0}},i};t.prototype=window.Event.prototype,window.CustomEvent=t}}(),window.addEventListener("load",()=>{console.log("dev tools ...")}),window.addEventListener("load",()=>{}),window.addEventListener("load",()=>{(()=>{Array.prototype.diff=function(e){return this.filter(t=>e.indexOf(t)<0)};const e=document.querySelector(".live-pull.frontpage");if(e){const t=[];e.querySelectorAll("article[data-id]").forEach(e=>{t.push(parseInt(e.dataset.id,10))});new EventSource("https://pubsub.digg.com/stream/frontpage").addEventListener("new-stories-available",e=>{const i=JSON.parse(e.data).diff(t).length;if(i>0){const e=document.querySelector(".live-pull-refresh-button");let t="story";i>1&&(t="stories"),e.querySelector("label").innerText=`${i} new ${t} available`,e.classList.add("open"),e.addEventListener("click",()=>{window.location.reload()})}console.log(i)})}})()});const protocolAndDomainRE=/^(?:\w+:)?\/\/(\S+)$/,localhostDomainRE=/^localhost[\:?\d]*(?:[^\:?\d]\S*)?$/,nonLocalhostDomainRE=/^[^\s\.]+\.\S{2,}$/;function isUrl(e){if("string"!=typeof e)return!1;const t=e.match(protocolAndDomainRE);if(!t)return!1;const i=t[1];return!!i&&!(!localhostDomainRE.test(i)&&!nonLocalhostDomainRE.test(i))}(()=>{const e=e=>{Math.max(document.documentElement.clientWidth,window.innerWidth||0)<=1024?(e.classList.remove("grid"),e.classList.add("enable")):(e.classList.add("grid"),e.classList.remove("enable"))};document.querySelectorAll(".overflow").forEach(t=>{e(t),window.addEventListener("resize",i=>{e(t)})})})(),(()=>{const e=document.querySelectorAll(".account .delete");e&&e.forEach(e=>{e.addEventListener("click",t=>{confirm("Do you really want to delete this story?")&&(window.location.href=e.dataset.href)})})})(),(()=>{const e={getUrlMeta:e=>fetch("/api/submitted-link/url-meta?url="+e),getSubmittedLink:e=>fetch("/api/submitted-link?linkId="+e),saveFeaturedImage:(e,t)=>new Promise((i,n)=>{const s=new FormData;s.append("featuredImageFile",t);const o=new XMLHttpRequest;o.open("post","/submit-link/upload-featured-image",!0),o.upload.onprogress=t=>{t.lengthComputable&&e.dispatch("setFeaturedImageUploadProgress",t.loaded/t.total*100)},o.upload.addEventListener("timeout",e=>{n(new Error(o.statusText))}),o.addEventListener("loadend",t=>{e.dispatch("setFeaturedImageUploadProgress",-1)},!1),o.addEventListener("readystatechange",(function(e){4===this.readyState&&i(o.response)})),o.onerror=e=>{n(new Error(o.statusText))},o.send(s)}),saveSubmittedLink:e=>fetch("/submit-link",{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify({hashId:e.state.hashId,namespaceSlug:e.state.namespaceSlug,title:e.state.title,kicker:e.state.kicker,description:e.state.description,uri:e.state.uri,lede:e.state.lede,points:e.state.points,socialLink:e.state.socialLink,featuredImageUri:e.state.featuredImageUri,fromBookmark:!0})})};if(document.querySelector(".wrapper.wrapper-bookmark-link")){const t={setUri:(e,t)=>(e.uri=t,e),setFeaturedImageUri:(e,t)=>(e.featuredImageUri=t,e),setTitle:(e,t)=>(e.title=t,e),setNamespaceSlug:(e,t)=>(e.namespaceSlug=t,e),setKicker:(e,t)=>(e.kicker=t,e),setDescription:(e,t)=>(e.description=t,e),setLede:(e,t)=>(e.lede=t,e),setPoints:(e,t)=>(e.points=t,e),setSocialLink:(e,t)=>(e.socialLink=t,e),setValidating:(e,t)=>(e.validating=t,e),setFeaturedImageUploadProgress:(e,t)=>(e.featuredImageUploadProgress=t,e),setFeaturedImageCroppingStatus:(e,t)=>(e.featuredImageCroppingStatus=t,e)},i={setUri(e,t){e.commit("setUri",t)},setTitle(e,t){e.commit("setTitle",t)},setNamespaceSlug(e,t){e.commit("setNamespaceSlug",t)},setKicker(e,t){e.commit("setKicker",t)},setFeaturedImageUri(e,t){e.commit("setFeaturedImageUri",t)},setDescription(e,t){e.commit("setDescription",t)},setLede(e,t){e.commit("setLede",t)},setPoints(e,t){e.commit("setPoints",t)},setSocialLink(e,t){e.commit("setSocialLink",t)},setValidating(e,t){e.commit("setValidating",t)},setFeaturedImageFileBlob(t,i){e.saveFeaturedImage(window.bookmarkLinkStore,i).then(e=>{const i=JSON.parse(e);!{}.hasOwnProperty.call(i,"success")||"1"!==i.success?console.log(e):(t.commit("setFeaturedImageUri",i.embed.imageUrl),t.commit("setFeaturedImageCroppingStatus",!1))}).catch(e=>{console.log(e)})},setFeaturedImageFile(t,i){e.saveFeaturedImage(window.bookmarkLinkStore,i).then(e=>{const i=JSON.parse(e);!{}.hasOwnProperty.call(i,"success")||"1"!==i.success?console.log(e):(t.commit("setFeaturedImageUri",i.embed.imageUrl),window.dispatchEvent(new Event("submittedLinkFeaturedImageFinishedUploading")))}).catch(e=>{console.log(e)})},setFeaturedImageUploadProgress(e,t){e.commit("setFeaturedImageUploadProgress",t)},setFeaturedImageCroppingStatus(e,t){e.commit("setFeaturedImageCroppingStatus",t)}};class n extends FsmComponent{constructor(){super({store:window.bookmarkLinkStore,elements:{divWrapperBookmarkLink:document.querySelector(".wrapper.wrapper-bookmark-link"),divThankYou:document.querySelector(".wrapper-bookmark-link .bookmark-link__thank-you"),divBookmarkLinkForm:document.querySelector(".wrapper-bookmark-link .bookmark-link-form"),divSubmitPreview:document.querySelector(".wrapper-bookmark-link .bookmark-link-preview"),btnSubmit:document.querySelector(".wrapper-bookmark-link .bookmark-link-form__btn"),inputTitle:document.querySelector(".wrapper-bookmark-link .bookmark-link-form .bookmark-link-form__title"),inputUri:document.querySelector(".wrapper-bookmark-link .bookmark-link-form .bookmark-link-form__url"),inputKicker:document.querySelector(".wrapper-bookmark-link .bookmark-link-form .bookmark-link-form__kicker"),inputDescription:document.querySelector(".wrapper-bookmark-link .bookmark-link-form .bookmark-link-form__description"),inputImageUri:document.querySelector("#bookmark-link-form__image-input-uri"),inputLinkId:document.querySelector("#bookmark-link-form__link-id"),previewTitle:document.querySelector(".wrapper-bookmark-link .bookmark-link-preview .bookmark-link-preview__title"),previewKicker:document.querySelector(".wrapper-bookmark-link .bookmark-link-preview .bookmark-link-preview__kicker"),previewDescription:document.querySelector(".wrapper-bookmark-link .bookmark-link-preview .bookmark-link-preview__description"),previewUri:document.querySelector(".wrapper-bookmark-link .bookmark-link-preview .bookmark-link-preview__metadata a"),divImageDropArea:document.querySelector(".bookmark-link-form__image-drop-area"),inputStoryImage:document.querySelector("#bookmark-link-form__image-input"),imgImage:document.querySelector(".bookmark-link-form__image-wrap img"),divUploadProgress:document.querySelector(".bookmark-link-form__upload-progress"),aCropCommand:document.querySelector(".bookmark-link-form__crop-command"),aCropFinishCommand:document.querySelector(".bookmark-link-form__crop-finish-command"),aCropCancelCommand:document.querySelector(".bookmark-link-form__crop-cancel-command"),inputNamespaceSlug:document.querySelector("input.bookmark-link-form__namespace-slug"),selectNamespaceSlug:document.querySelector("select.bookmark-link-form__namespace-slug"),aAdvancedOptionsToggle:document.querySelector(".advanced-options-toggle"),divAdvancedOptions:document.querySelector(".advanced-options"),inputLede:document.querySelector(".bookmark-link-form__lede"),inputPoints:document.querySelector(".bookmark-link-form__points"),inputSocialLink:document.querySelector(".bookmark-link-form__social-link")}}),this.elements.inputNamespaceSlug?window.bookmarkLinkStore.dispatch("setNamespaceSlug",this.elements.inputNamespaceSlug.value):this.elements.selectNamespaceSlug&&(window.bookmarkLinkStore.dispatch("setNamespaceSlug",this.elements.selectNamespaceSlug.value),this.elements.selectNamespaceSlug.addEventListener("change",e=>{window.bookmarkLinkStore.dispatch("setNamespaceSlug",this.elements.selectNamespaceSlug.value)})),window.bookmarkLinkStore.state.title&&window.bookmarkLinkStore.state.title.trim().length>0&&(this.elements.inputTitle.value=DiggUtils.stripHtml(window.bookmarkLinkStore.state.title)),window.bookmarkLinkStore.state.kicker.trim().length>0&&(this.elements.inputKicker.value=DiggUtils.stripHtml(window.bookmarkLinkStore.state.kicker)),window.bookmarkLinkStore.state.uri.trim().length>0&&(this.elements.inputUri.value=DiggUtils.stripHtml(window.bookmarkLinkStore.state.uri)),window.bookmarkLinkStore.state.description.trim().length>0&&(this.elements.inputDescription.value=DiggUtils.stripHtml(window.bookmarkLinkStore.state.description)),window.bookmarkLinkStore.state.lede.trim().length>0&&(this.elements.inputLede.value=DiggUtils.stripHtml(window.bookmarkLinkStore.state.lede)),window.bookmarkLinkStore.state.points.length>0&&(this.elements.inputPoints.value=DiggUtils.stripHtml(window.bookmarkLinkStore.state.points)),window.bookmarkLinkStore.state.socialLink.length>0&&(this.elements.inputSocialLink.value=DiggUtils.stripHtml(window.bookmarkLinkStore.state.socialLink)),this.elements.inputTitle&&this.elements.previewTitle&&this.elements.inputTitle.addEventListener("blur",e=>{if(this.elements.inputTitle.value.trim().length>0||window.bookmarkLinkStore.validating||window.bookmarkLinkStore.state.title.length>0){this.validateTitle();let e=DiggUtils.stripHtml(this.elements.inputTitle.value.trim());0===e.length&&(e=DiggUtils.stripHtml(this.elements.inputTitle.placeholder)),window.bookmarkLinkStore.dispatch("setTitle",e)}}),this.elements.inputUri&&this.elements.previewUri&&this.elements.inputUri.addEventListener("blur",t=>{if(this.elements.inputUri.value.trim().length>0||window.bookmarkLinkStore.validating||window.bookmarkLinkStore.state.uri.length>0){this.validateUri();let t=DiggUtils.stripHtml(this.elements.inputUri.value.trim());0===t.length&&(t=DiggUtils.stripHtml(this.elements.inputUri.placeholder.trim())),window.bookmarkLinkStore.dispatch("setUri",t),e.getUrlMeta(t).then(e=>e.json()).then(e=>{window.bookmarkLinkStore.dispatch("setTitle",e.title),window.bookmarkLinkStore.dispatch("setDescription",e.description),window.bookmarkLinkStore.dispatch("setFeaturedImageUri",e.imageUrl)})}}),this.elements.inputKicker&&this.elements.previewKicker&&this.elements.inputKicker.addEventListener("blur",e=>{if(this.elements.inputKicker.value.trim().length>0||window.bookmarkLinkStore.validating||window.bookmarkLinkStore.state.kicker.length>0){this.validateKicker();let e=DiggUtils.stripHtml(this.elements.inputKicker.value.trim());0===e.length&&(e=DiggUtils.stripHtml(this.elements.inputKicker.placeholder.trim())),window.bookmarkLinkStore.dispatch("setKicker",e)}}),this.elements.inputDescription&&this.elements.previewDescription&&this.elements.inputDescription.addEventListener("blur",e=>{if(this.elements.inputDescription.value.trim().length>0||window.bookmarkLinkStore.validating||window.bookmarkLinkStore.state.description.length>0){this.validateDescription();let e=DiggUtils.stripHtml(this.elements.inputDescription.value.trim());0===e.length&&(e=DiggUtils.stripHtml(this.elements.inputDescription.placeholder.trim())),window.bookmarkLinkStore.dispatch("setDescription",e)}}),this.elements.aCropCancelCommand&&this.elements.aCropCancelCommand.addEventListener("click",e=>{window.bookmarkLinkStore.dispatch("setFeaturedImageCroppingStatus",!1),""!==this.elements.imgImage.getAttribute("src")&&(this.destroyCropper(),this.imageDropAreaEnableClick()),e.preventDefault()}),this.elements.aCropCommand&&this.elements.aCropCommand.addEventListener("click",e=>{""!==this.elements.imgImage.getAttribute("src")&&this.initializeCropper(),e.preventDefault()}),this.elements.aCropFinishCommand&&this.elements.aCropFinishCommand.addEventListener("click",e=>{""!==this.elements.imgImage.getAttribute("src")&&(this.saveCroppedImage(),this.destroyCropper(),this.imageDropAreaEnableClick()),e.preventDefault()}),this.elements.inputStoryImage&&this.elements.inputStoryImage.addEventListener("change",()=>{this.handleFileUpload(this.elements.inputStoryImage.files[0])},!1),this.elements.divImageDropArea&&(this.elements.divImageDropArea.addEventListener("drop",e=>{if(!window.bookmarkLinkStore.state.featuredImageCroppingStatus){this.elements.divImageDropArea.classList.remove("bookmark-link-form__image-drop-area--highlight");const t=e.dataTransfer,{files:i}=t;i.length>0&&this.handleFileUpload(i[0])}e.preventDefault(),e.stopPropagation()},!1),this.elements.divImageDropArea.addEventListener("dragenter",e=>{window.bookmarkLinkStore.state.featuredImageCroppingStatus||this.elements.divImageDropArea.classList.add("bookmark-link-form__image-drop-area--highlight"),e.preventDefault(),e.stopPropagation()},!1),this.elements.divImageDropArea.addEventListener("dragover",e=>{window.bookmarkLinkStore.state.featuredImageCroppingStatus||this.elements.divImageDropArea.classList.add("bookmark-link-form__image-drop-area--highlight"),e.preventDefault(),e.stopPropagation()},!1),this.elements.divImageDropArea.addEventListener("dragleave",e=>{this.elements.divImageDropArea.classList.remove("bookmark-link-form__image-drop-area--highlight"),e.preventDefault(),e.stopPropagation()},!1)),this.elements.divThankYou&&this.elements.divBookmarkLinkForm&&this.elements.divSubmitPreview&&this.elements.btnSubmit&&this.elements.btnSubmit.addEventListener("click",t=>{window.bookmarkLinkStore.dispatch("setValidating",!0),this.validateForm()&&(window.bookmarkLinkStore.dispatch("setValidating",!1),this.elements.divBookmarkLinkForm.style.display="none",this.elements.divSubmitPreview.style.display="none",this.elements.divThankYou.style.display="block",e.saveSubmittedLink(window.bookmarkLinkStore).then(e=>{}).catch(e=>{console.log(e)})),t.preventDefault()}),window.addEventListener("submittedLinkFeaturedImageFinishedUploading",()=>{this.initializeCropper()}),this.elements.aAdvancedOptionsToggle&&this.elements.aAdvancedOptionsToggle.addEventListener("click",e=>{this.elements.aAdvancedOptionsToggle.classList.contains("advanced-options-toggle--active")?(this.elements.aAdvancedOptionsToggle.classList.remove("advanced-options-toggle--active"),this.elements.divAdvancedOptions&&this.elements.divAdvancedOptions.classList.remove("advanced-options--show")):(this.elements.aAdvancedOptionsToggle.classList.add("advanced-options-toggle--active"),this.elements.divAdvancedOptions&&this.elements.divAdvancedOptions.classList.add("advanced-options--show")),e.preventDefault()}),this.elements.inputLede&&this.elements.inputLede.addEventListener("blur",e=>{if(this.elements.inputLede.value.trim().length>0){const e=DiggUtils.stripHtml(this.elements.inputLede.value.trim());window.bookmarkLinkStore.dispatch("setLede",e)}}),this.elements.inputPoints&&(this.elements.inputPoints.addEventListener("blur",e=>{if(this.elements.inputPoints.value.trim().length>0){const e=DiggUtils.stripHtml(this.elements.inputPoints.value.trim());window.bookmarkLinkStore.dispatch("setPoints",e)}}),this.elements.inputPoints.addEventListener("keydown",e=>{const t=this.elements.inputPoints.value.split("\n").length;13===e.keyCode&&t>=3&&e.preventDefault()})),this.elements.inputSocialLink&&this.elements.inputSocialLink.addEventListener("blur",e=>{if(this.elements.inputSocialLink.value.trim().length>0){const e=DiggUtils.stripHtml(this.elements.inputSocialLink.value.trim());window.bookmarkLinkStore.dispatch("setSocialLink",e)}})}render(){window.bookmarkLinkStore.state.featuredImageCroppingStatus?this.elements.divImageDropArea.classList.add("bookmark-link-form__image-drop-area--cropping"):this.elements.divImageDropArea.classList.remove("bookmark-link-form__image-drop-area--cropping"),window.bookmarkLinkStore.state.featuredImageUploadProgress<=-1?this.elements.divUploadProgress.style.display="none":(this.elements.divUploadProgress.style.width=window.bookmarkLinkStore.state.featuredImageUploadProgress+"%",this.elements.divUploadProgress.style.display="block"),window.bookmarkLinkStore.state.featuredImageUri&&window.bookmarkLinkStore.state.featuredImageUri.length>0&&(this.elements.imgImage.setAttribute("src",DiggUtils.stripHtml(window.bookmarkLinkStore.state.featuredImageUri)),this.elements.inputImageUri.value=DiggUtils.stripHtml(window.bookmarkLinkStore.state.featuredImageUri),this.elements.divImageDropArea.classList.add("bookmark-link-form__image-drop-area--has-image")),window.bookmarkLinkStore.state.title&&window.bookmarkLinkStore.state.title.trim().length>0?(this.elements.previewTitle.innerHTML=DiggUtils.stripHtml(window.bookmarkLinkStore.state.title),this.elements.inputTitle.value=DiggUtils.stripHtml(window.bookmarkLinkStore.state.title)):this.elements.previewTitle.innerHTML=DiggUtils.stripHtml(this.elements.inputTitle.placeholder),window.bookmarkLinkStore.state.kicker&&window.bookmarkLinkStore.state.kicker.trim().length>0?this.elements.previewKicker.innerHTML=DiggUtils.stripHtml(window.bookmarkLinkStore.state.kicker):this.elements.previewKicker.innerHTML=DiggUtils.stripHtml(this.elements.inputKicker.placeholder),window.bookmarkLinkStore.state.uri&&window.bookmarkLinkStore.state.uri.trim().length>0?(this.elements.inputUri.value=DiggUtils.stripHtml(window.bookmarkLinkStore.state.uri),this.elements.previewUri.innerHTML=DiggUtils.extractHostname(DiggUtils.stripHtml(window.bookmarkLinkStore.state.uri))):this.elements.previewUri.innerHTML=DiggUtils.extractHostname(DiggUtils.stripHtml(this.elements.inputUri.placeholder)),window.bookmarkLinkStore.state.description&&window.bookmarkLinkStore.state.description.trim().length>0?(this.elements.previewDescription.innerHTML=DiggUtils.stripHtml(window.bookmarkLinkStore.state.description),this.elements.inputDescription.value=DiggUtils.stripHtml(window.bookmarkLinkStore.state.description)):this.elements.previewDescription.innerHTML=DiggUtils.stripHtml(this.elements.inputDescription.placeholder)}destroyCropper(){this.featuredImageCropper&&this.featuredImageCropper.destroy()}saveCroppedImage(){if(this.featuredImageCropper){this.featuredImageCropper.getCroppedCanvas().toBlob(e=>{window.bookmarkLinkStore.dispatch("setFeaturedImageFileBlob",e),window.bookmarkLinkStore.dispatch("setFeaturedImageUploadProgress",0)})}}handleFileUpload(e){window.bookmarkLinkStore.dispatch("setFeaturedImageFile",e),window.bookmarkLinkStore.dispatch("setFeaturedImageUploadProgress",0)}initializeCropper(){window.bookmarkLinkStore.dispatch("setFeaturedImageCroppingStatus",!0),this.featuredImageCropper&&this.featuredImageCropper.destroy(),this.featuredImageCropper=new Cropper(this.elements.imgImage,{checkCrossOrigin:!1,aspectRatio:35/19}),this.imageDropAreaDisableClick()}imageDropAreaDisableClick(){this.elements.divImageDropArea.addEventListener("click",this.stopDefaultAndPropagation)}imageDropAreaEnableClick(){this.elements.divImageDropArea.removeEventListener("click",this.stopDefaultAndPropagation)}stopDefaultAndPropagation(e){e.preventDefault(),e.stopPropagation()}validateUri(){let e=0;this.elements.inputUri.classList.remove("error");const t=this.elements.inputUri.value.trim();return 0===t.length||this.elements.inputUri.value===this.elements.inputUri.getAttribute("placeholder")?(e++,this.elements.inputUri.classList.add("error")):isUrl(t)||(e++,this.elements.inputUri.classList.add("error")),e}validateTitle(){let e=0;return this.elements.inputTitle.classList.remove("error"),0!==this.elements.inputTitle.value.trim().length&&this.elements.inputTitle.value!==this.elements.inputTitle.getAttribute("placeholder")||(e++,this.elements.inputTitle.classList.add("error")),e}validateKicker(){return this.elements.inputKicker.classList.remove("error"),0}validateDescription(){let e=0;return this.elements.inputDescription.classList.remove("error"),0!==this.elements.inputDescription.value.trim().length&&this.elements.inputDescription.value!==this.elements.inputDescription.getAttribute("placeholder")||(e++,this.elements.inputDescription.classList.add("error")),e}validateForm(){let e=0;return e+=this.validateTitle(),e+=this.validateUri(),e+=this.validateKicker(),e+=this.validateDescription(),0===e}}const s=(t,i)=>{const s={uri:window.submittedLink.uri,title:window.submittedLink.title,kicker:window.submittedLink.kicker,description:window.submittedLink.description,featuredImageUri:window.submittedLink.featuredImageUri,featuredImageUploadProgress:-1,featuredImageCroppingStatus:!1,validating:!1,lede:window.submittedLink.lede,points:window.submittedLink.points,socialLink:window.submittedLink.socialLink,namespaceSlug:"",hashId:window.submittedLink.hashId};window.bookmarkLinkStore=new FsmStore({actions:t,mutations:i,state:s});(new n).render(),window.bookmarkUrl&&(window.bookmarkLinkStore.dispatch("setUri",window.bookmarkUrl),e.getUrlMeta(window.bookmarkUrl).then(e=>e.json()).then(e=>{window.bookmarkLinkStore.dispatch("setTitle",e.title),window.bookmarkLinkStore.dispatch("setDescription",e.description),window.bookmarkLinkStore.dispatch("setFeaturedImageUri",e.imageUrl)}))};window.submittedLink.uri="",window.submittedLink.title="",window.submittedLink.kicker="",window.submittedLink.description="",window.submittedLink.featuredImageUri="",window.submittedLink.lede="",window.submittedLink.points="",window.submittedLink.socialLink="",s(i,t)}})(),(()=>{let e=document.querySelectorAll(".comment-list .delete-comment");e&&e.forEach(e=>{e.addEventListener("click",t=>{const i=encodeURI(window.location.pathname),n=`/comments/delete?commentId=${encodeURI(e.dataset.id)}&returnTo=${i}`;confirm("Do you really want to delete this comment?")&&(window.location.href=n)})});let t=document.querySelectorAll(".comment-list .flag-comment");t&&t.forEach(e=>{e.addEventListener("click",t=>{const i=encodeURI(window.location.pathname),n=`/comments/flag?commentId=${encodeURI(e.dataset.id)}&returnTo=${i}`;confirm("Do you really want to flag this comment?")&&(window.location.href=n)})});let i=document.querySelector("#comment-form"),n=document.querySelectorAll(".comments .reply");if(n){const e=document.querySelector(".comments .reply.main-thread");n.forEach(t=>{t.addEventListener("click",n=>{let s=n.target.parentNode,o=s.dataset.commentId;t.classList.contains("main-thread")?(e.style.display="none",o=""):e.style.display="inline-block",i.querySelector("textarea[name=contents]").value="",i.querySelector("input[name=parentId]").value=o,s.appendChild(i)})})}})(),window.addEventListener("load",async()=>{document.querySelector(".login-modal")&&document.querySelector(".login-modal").addEventListener("click",e=>{e.target.classList.contains("login-modal")&&(e.target.style.display="none",e.target.classList.contains("reload-on-close")&&window.location.reload())})});const linkLoginModals=document.querySelectorAll(".link-open-login-modal");async function openLoginModal(){document.querySelector(".login-modal").style.display="block",document.querySelectorAll(".login-modal .step").forEach(e=>e.style.display="none"),document.querySelector(".login-modal .step:nth-child(1)").style.display="block"}async function closeLoginModal(){document.querySelector(".login-modal").style.display="none",window.location.reload()}async function openAuthenticationWindow(e){window.open(e,"LogIn","width=600,height=400,toolbar=0,scrollbars=0,status=0,resizable=0,location=0,menuBar=0")}linkLoginModals&&linkLoginModals.forEach(e=>{e.addEventListener("click",(async function(e){openLoginModal(),e.preventDefault()}))});const loginTwitterLink=document.querySelector(".login-twitter-link");loginTwitterLink&&loginTwitterLink.addEventListener("click",(async function(e){openAuthenticationWindow(loginTwitterLink.dataset.href)}));const loginFacebookLink=document.querySelector(".login-facebook-link");loginFacebookLink&&loginFacebookLink.addEventListener("click",(async function(e){openAuthenticationWindow(loginFacebookLink.dataset.href)}));const loginGoogleLink=document.querySelector(".login-google-link");async function finalizeLoginAndSubscription(){const e=[];document.querySelectorAll(".login-modal .subscriptions input[type=checkbox]").forEach(t=>{t.checked&&e.push(t.id)});await fetch("/api/user/subscriptions",{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify({subscriptions:e})});document.querySelectorAll(".login-modal .step").forEach(e=>e.style.display="none"),document.querySelector(".login-modal .step:nth-child(3)").style.display="block"}loginGoogleLink&&loginGoogleLink.addEventListener("click",(async function(e){openAuthenticationWindow(loginGoogleLink.dataset.href)})),window.addEventListener("message",(async function(e){if(e.data.event)if(e.data.user)if(localStorage.getItem("digg-account-created-"+e.data.user.emailHash))closeLoginModal();else{const t=document.querySelectorAll(".login-modal .subscriptions input[type=checkbox]");t&&t.forEach(t=>{try{e.data.user.subscriptions&&e.data.user.subscriptions.includes(t.id)&&(t.checked=!0)}catch{}}),document.querySelectorAll(".login-modal .step").forEach(e=>e.style.display="none"),document.querySelector(".login-modal .step .email").textContent=e.data.user.email,document.querySelector(".login-modal .step:nth-child(2)").style.display="block",document.querySelector(".login-modal").classList.add("reload-on-close"),localStorage.setItem("digg-account-created-"+e.data.user.emailHash,1)}else closeLoginModal()})),(()=>{const e=document.querySelector(".main-navigation .account"),t=document.querySelector(".main-navigation .account-menu");t&&(window.addEventListener("click",i=>{i.target!==e&&i.target!==t&&t.classList.remove("active")}),e.addEventListener("click",()=>{t.classList.toggle("active")}));let i=(window.pageYOffset||document.documentElement.scrollTop)-(document.documentElement.clientTop||0);document.onscroll=()=>{if(window.innerWidth>=480){const e=(window.pageYOffset||document.documentElement.scrollTop)-(document.documentElement.clientTop||0),t=document.querySelectorAll(".main-navigation"),n=document.querySelector(".ads-homepage-leaderboard-atf > div");document.querySelector("body");let s="",o=0;n&&(s=n.style.display,o=n.offsetHeight),t.forEach(t=>{e<=i||e<=0?t.classList.remove("hidden"):e>i&&t.classList.add("hidden")}),i=e}};const n=document.querySelector(".main-navigation .mobile-menu"),s=document.querySelector(".main-navigation .hamburger");s&&n&&s.addEventListener("click",e=>{n.classList.toggle("hide")});const o=document.querySelector(".main-navigation .close-mobile-menu");o&&n&&o.addEventListener("click",e=>{n.classList.toggle("hide")})})(),(()=>{let e=document.querySelectorAll(".moderation .operations svg"),t=document.querySelectorAll(".moderation .operations .actions");e&&(e.forEach(e=>{e.addEventListener("click",e=>{let i=e.target.parentNode.querySelector(".actions"),n=i.classList.contains("show");t.forEach(e=>{e.classList.remove("show")}),n?i.classList.remove("show"):i.classList.add("show")})}),document.body.addEventListener("click",e=>{e.target.classList.contains("action-icon")||t.forEach(e=>{e.classList.remove("show")})}));let i=document.querySelectorAll(".moderation .operations .actions .delete");i&&i.forEach(e=>{e.addEventListener("click",t=>{const i=encodeURI(e.dataset.href);confirm("Do you really want to delete this link?")&&(window.location.href=i)})})})(),(()=>{const e=document.querySelector(".moderation .filter");e&&e.addEventListener("keyup",t=>{const i=e.value.toLowerCase();document.querySelectorAll(".moderation .filter-item").forEach(e=>{e.querySelectorAll(".filter-content").forEach(t=>{t.innerText.toLowerCase().indexOf(i)>=0?e.style.display="initial":e.style.display="none"})})})})(),(()=>{document.querySelectorAll("figure.story-image-container").forEach(e=>{const t=e.querySelector("img.lazy-image-img");t&&t.dataset.src&&(t.src=t.dataset.src)});const e=document.querySelector(".infinite-scroll-title");if(e){const t=e.innerText,i=window.location.pathname,n=document.querySelector(".fp-featured-story");if(n){let e="article";window.addEventListener("scroll",s=>{n.getBoundingClientRect().top-100<0?"frontpage"!==e&&(document.title="Digg - What the Internet is talking about right now",window.history.pushState("object or string","Page Title","/"),e="frontpage"):"article"!==e&&(document.title=t,window.history.pushState("object or string","Page Title",i),e="article")})}}})(),(()=>{document.querySelectorAll("figure.story-image-container").forEach(e=>{const t=e.querySelector("img.lazy-image-img");t&&t.dataset.src&&(t.src=t.dataset.src)});const e=document.querySelector(".infinite-scroll-title");if(e){const t=e.innerText,i=window.location.pathname,n=document.querySelector(".fp-featured-story");if(n){let e="article";window.addEventListener("scroll",s=>{n.getBoundingClientRect().top-100<0?"frontpage"!==e&&(document.title="Digg - What the Internet is talking about right now",window.history.pushState("object or string","Page Title","/"),e="frontpage"):"article"!==e&&(document.title=t,window.history.pushState("object or string","Page Title",i),e="article")})}}})(),(()=>{const e={getUserStory:e=>fetch("/api/user-story?storyId="+e)},t={getUrlMeta:e=>fetch("/api/submitted-link/url-meta?url="+e),getSubmittedLink:e=>fetch("/api/submitted-link?linkId="+e),saveFeaturedImage:(e,t)=>new Promise((i,n)=>{const s=new FormData;s.append("featuredImageFile",t);const o=new XMLHttpRequest;o.open("post","/submit-link/upload-featured-image",!0),o.upload.onprogress=t=>{t.lengthComputable&&e.dispatch("setFeaturedImageUploadProgress",t.loaded/t.total*100)},o.upload.addEventListener("timeout",e=>{n(new Error(o.statusText))}),o.addEventListener("loadend",t=>{e.dispatch("setFeaturedImageUploadProgress",-1)},!1),o.addEventListener("readystatechange",(function(e){4===this.readyState&&i(o.response)})),o.onerror=e=>{n(new Error(o.statusText))},o.send(s)}),saveSubmittedLink:e=>fetch("/submit-link",{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify({hashId:e.state.hashId,namespaceSlug:e.state.namespaceSlug,title:e.state.title,kicker:e.state.kicker,description:e.state.description,uri:e.state.uri,lede:e.state.lede,points:e.state.points,socialLink:e.state.socialLink,featuredImageUri:e.state.featuredImageUri})})};if(document.querySelector(".wrapper.submit-link")){const i={setUri:(e,t)=>(e.uri=t,e),setFeaturedImageUri:(e,t)=>(e.featuredImageUri=t,e),setTitle:(e,t)=>(e.title=t,e),setKicker:(e,t)=>(e.kicker=t,e),setDescription:(e,t)=>(e.description=t,e),setLede:(e,t)=>(e.lede=t,e),setPoints:(e,t)=>(e.points=t,e),setSocialLink:(e,t)=>(e.socialLink=t,e),setValidating:(e,t)=>(e.validating=t,e),setFeaturedImageUploadProgress:(e,t)=>(e.featuredImageUploadProgress=t,e),setFeaturedImageCroppingStatus:(e,t)=>(e.featuredImageCroppingStatus=t,e)},n={setUri(e,t){e.commit("setUri",t)},setTitle(e,t){e.commit("setTitle",t)},setKicker(e,t){e.commit("setKicker",t)},setFeaturedImageUri(e,t){e.commit("setFeaturedImageUri",t)},setDescription(e,t){e.commit("setDescription",t)},setLede(e,t){e.commit("setLede",t)},setPoints(e,t){e.commit("setPoints",t)},setSocialLink(e,t){e.commit("setSocialLink",t)},setValidating(e,t){e.commit("setValidating",t)},setFeaturedImageFileBlob(e,i){t.saveFeaturedImage(window.submitLinkStore,i).then(t=>{const i=JSON.parse(t);!{}.hasOwnProperty.call(i,"success")||"1"!==i.success?console.log(t):(e.commit("setFeaturedImageUri",i.embed.imageUrl),e.commit("setFeaturedImageCroppingStatus",!1))}).catch(e=>{console.log(e)})},setFeaturedImageFile(e,i){t.saveFeaturedImage(window.submitLinkStore,i).then(t=>{const i=JSON.parse(t);!{}.hasOwnProperty.call(i,"success")||"1"!==i.success?console.log(t):(e.commit("setFeaturedImageUri",i.embed.imageUrl),window.dispatchEvent(new Event("submittedLinkFeaturedImageFinishedUploading")))}).catch(e=>{console.log(e)})},setFeaturedImageUploadProgress(e,t){e.commit("setFeaturedImageUploadProgress",t)},setFeaturedImageCroppingStatus(e,t){e.commit("setFeaturedImageCroppingStatus",t)}};class s extends FsmComponent{constructor(){super({store:window.submitLinkStore,elements:{divWrapperSubmitLink:document.querySelector(".wrapper.submit-link"),divThankYou:document.querySelector(".submit-link .submit-link__thank-you"),divSubmitLinkForm:document.querySelector(".submit-link .submit-link-form"),divSubmitPreview:document.querySelector(".submit-link .submit-link-preview"),btnSubmit:document.querySelector(".submit-link .submit-link-form__btn"),inputTitle:document.querySelector(".submit-link .submit-link-form .submit-link-form__title"),inputUri:document.querySelector(".submit-link .submit-link-form .submit-link-form__url"),inputKicker:document.querySelector(".submit-link .submit-link-form .submit-link-form__kicker"),inputDescription:document.querySelector(".submit-link .submit-link-form .submit-link-form__description"),inputImageUri:document.querySelector("#submit-link-form__image-input-uri"),inputLinkId:document.querySelector("#submit-link-form__link-id"),previewTitle:document.querySelector(".submit-link .submit-link-preview .submit-link-preview__title"),previewKicker:document.querySelector(".submit-link .submit-link-preview .submit-link-preview__kicker"),previewDescription:document.querySelector(".submit-link .submit-link-preview .submit-link-preview__description"),previewUri:document.querySelector(".submit-link .submit-link-preview .submit-link-preview__metadata a"),divImageDropArea:document.querySelector(".submit-link-form__image-drop-area"),inputStoryImage:document.querySelector("#submit-link-form__image-input"),imgImage:document.querySelector(".submit-link-form__image-wrap img"),divUploadProgress:document.querySelector(".submit-link-form__upload-progress"),aCropCommand:document.querySelector(".submit-link-form__crop-command"),aCropFinishCommand:document.querySelector(".submit-link-form__crop-finish-command"),aCropCancelCommand:document.querySelector(".submit-link-form__crop-cancel-command"),aAdvancedOptionsToggle:document.querySelector(".advanced-options-toggle"),divAdvancedOptions:document.querySelector(".advanced-options"),inputLede:document.querySelector(".submit-link-form__lede"),inputPoints:document.querySelector(".submit-link-form__points"),inputSocialLink:document.querySelector(".submit-link-form__social-link"),imageAreaDragDropText:document.querySelector(".submit-link-form__dragdroptext")}}),window.submitLinkStore.state.title&&window.submitLinkStore.state.title.trim().length>0&&(this.elements.inputTitle.value=DiggUtils.stripHtml(window.submitLinkStore.state.title)),window.submitLinkStore.state.kicker.trim().length>0&&(this.elements.inputKicker.value=DiggUtils.stripHtml(window.submitLinkStore.state.kicker)),window.submitLinkStore.state.uri.trim().length>0&&(this.elements.inputUri.value=DiggUtils.stripHtml(window.submitLinkStore.state.uri)),window.submitLinkStore.state.description.trim().length>0&&(this.elements.inputDescription.value=DiggUtils.stripHtml(window.submitLinkStore.state.description)),window.submitLinkStore.state.lede.trim().length>0&&(this.elements.inputLede.value=DiggUtils.stripHtml(window.submitLinkStore.state.lede)),window.submitLinkStore.state.points.length>0&&(this.elements.inputPoints.value=DiggUtils.stripHtml(window.submitLinkStore.state.points)),window.submitLinkStore.state.socialLink.length>0&&(this.elements.inputSocialLink.value=DiggUtils.stripHtml(window.submitLinkStore.state.socialLink)),this.elements.inputTitle&&this.elements.previewTitle&&this.elements.inputTitle.addEventListener("blur",e=>{if(this.elements.inputTitle.value.trim().length>0||window.submitLinkStore.validating||window.submitLinkStore.state.title.length>0){this.validateTitle();let e=DiggUtils.stripHtml(this.elements.inputTitle.value.trim());0===e.length&&(e=DiggUtils.stripHtml(this.elements.inputTitle.placeholder)),window.submitLinkStore.dispatch("setTitle",e)}}),this.elements.inputUri&&this.elements.previewUri&&this.elements.inputUri.addEventListener("blur",e=>{if(this.elements.inputUri.value.trim().length>0||window.submitLinkStore.validating||window.submitLinkStore.state.uri.length>0){this.validateUri();let e=DiggUtils.stripHtml(this.elements.inputUri.value.trim());0===e.length&&(e=DiggUtils.stripHtml(this.elements.inputUri.placeholder.trim())),window.submitLinkStore.dispatch("setUri",e),t.getUrlMeta(e).then(e=>e.json()).then(e=>{window.submitLinkStore.dispatch("setTitle",e.title),window.submitLinkStore.dispatch("setDescription",e.description),window.submitLinkStore.dispatch("setFeaturedImageUri",e.imageUrl)})}}),this.elements.inputKicker&&this.elements.previewKicker&&this.elements.inputKicker.addEventListener("blur",e=>{if(this.elements.inputKicker.value.trim().length>0||window.submitLinkStore.validating||window.submitLinkStore.state.kicker.length>0){this.validateKicker();let e=DiggUtils.stripHtml(this.elements.inputKicker.value.trim());0===e.length&&(e=DiggUtils.stripHtml(this.elements.inputKicker.placeholder.trim())),window.submitLinkStore.dispatch("setKicker",e)}}),this.elements.inputDescription&&this.elements.previewDescription&&this.elements.inputDescription.addEventListener("blur",e=>{if(this.elements.inputDescription.value.trim().length>0||window.submitLinkStore.validating||window.submitLinkStore.state.description.length>0){this.validateDescription();let e=DiggUtils.stripHtml(this.elements.inputDescription.value.trim());0===e.length&&(e=DiggUtils.stripHtml(this.elements.inputDescription.placeholder.trim())),window.submitLinkStore.dispatch("setDescription",e)}}),this.elements.aCropCancelCommand&&this.elements.aCropCancelCommand.addEventListener("click",e=>{window.submitLinkStore.dispatch("setFeaturedImageCroppingStatus",!1),""!==this.elements.imgImage.getAttribute("src")&&(this.destroyCropper(),this.imageDropAreaEnableClick()),e.preventDefault()}),this.elements.aCropCommand&&this.elements.aCropCommand.addEventListener("click",e=>{""!==this.elements.imgImage.getAttribute("src")&&this.initializeCropper(),e.preventDefault()}),this.elements.aCropFinishCommand&&this.elements.aCropFinishCommand.addEventListener("click",e=>{""!==this.elements.imgImage.getAttribute("src")&&(this.saveCroppedImage(),this.destroyCropper(),this.imageDropAreaEnableClick()),e.preventDefault()}),this.elements.inputStoryImage&&this.elements.inputStoryImage.addEventListener("change",()=>{this.handleFileUpload(this.elements.inputStoryImage.files[0])},!1),this.elements.divImageDropArea&&(this.elements.divImageDropArea.addEventListener("drop",e=>{if(!window.submitLinkStore.state.featuredImageCroppingStatus){this.elements.divImageDropArea.classList.remove("submit-link-form__image-drop-area--highlight");const t=e.dataTransfer,{files:i}=t;i.length>0&&this.handleFileUpload(i[0])}e.preventDefault(),e.stopPropagation()},!1),this.elements.divImageDropArea.addEventListener("dragenter",e=>{window.submitLinkStore.state.featuredImageCroppingStatus||this.elements.divImageDropArea.classList.add("submit-link-form__image-drop-area--highlight"),e.preventDefault(),e.stopPropagation()},!1),this.elements.divImageDropArea.addEventListener("dragover",e=>{window.submitLinkStore.state.featuredImageCroppingStatus||this.elements.divImageDropArea.classList.add("submit-link-form__image-drop-area--highlight"),e.preventDefault(),e.stopPropagation()},!1),this.elements.divImageDropArea.addEventListener("dragleave",e=>{this.elements.divImageDropArea.classList.remove("submit-link-form__image-drop-area--highlight"),e.preventDefault(),e.stopPropagation()},!1)),this.elements.divThankYou&&this.elements.divSubmitLinkForm&&this.elements.divSubmitPreview&&this.elements.btnSubmit&&this.elements.btnSubmit.addEventListener("click",e=>{window.submitLinkStore.dispatch("setValidating",!0),this.validateForm()&&(window.submitLinkStore.dispatch("setValidating",!1),this.elements.divSubmitLinkForm.style.display="none",this.elements.divSubmitPreview.style.display="none",this.elements.divThankYou.style.display="block",t.saveSubmittedLink(window.submitLinkStore).then(e=>{}).catch(e=>{console.log(e)})),e.preventDefault()}),this.elements.aAdvancedOptionsToggle&&this.elements.aAdvancedOptionsToggle.addEventListener("click",e=>{this.elements.aAdvancedOptionsToggle.classList.contains("advanced-options-toggle--active")?(this.elements.aAdvancedOptionsToggle.classList.remove("advanced-options-toggle--active"),this.elements.divAdvancedOptions&&this.elements.divAdvancedOptions.classList.remove("advanced-options--show")):(this.elements.aAdvancedOptionsToggle.classList.add("advanced-options-toggle--active"),this.elements.divAdvancedOptions&&this.elements.divAdvancedOptions.classList.add("advanced-options--show")),e.preventDefault()}),this.elements.inputLede&&this.elements.inputLede.addEventListener("blur",e=>{if(this.elements.inputLede.value.trim().length>0){const e=DiggUtils.stripHtml(this.elements.inputLede.value.trim());window.submitLinkStore.dispatch("setLede",e)}}),this.elements.inputPoints&&(this.elements.inputPoints.addEventListener("blur",e=>{if(this.elements.inputPoints.value.trim().length>0){const e=DiggUtils.stripHtml(this.elements.inputPoints.value.trim());window.submitLinkStore.dispatch("setPoints",e)}}),this.elements.inputPoints.addEventListener("keydown",e=>{const t=this.elements.inputPoints.value.split("\n").length;13===e.keyCode&&t>=3&&e.preventDefault()})),this.elements.inputSocialLink&&this.elements.inputSocialLink.addEventListener("blur",e=>{if(this.elements.inputSocialLink.value.trim().length>0){const e=DiggUtils.stripHtml(this.elements.inputSocialLink.value.trim());window.submitLinkStore.dispatch("setSocialLink",e)}}),window.addEventListener("submittedLinkFeaturedImageFinishedUploading",()=>{this.initializeCropper()})}render(){window.submitLinkStore.state.featuredImageCroppingStatus?this.elements.divImageDropArea.classList.add("submit-link-form__image-drop-area--cropping"):this.elements.divImageDropArea.classList.remove("submit-link-form__image-drop-area--cropping"),window.submitLinkStore.state.featuredImageUploadProgress<=-1?this.elements.divUploadProgress.style.display="none":(this.elements.divUploadProgress.style.width=window.submitLinkStore.state.featuredImageUploadProgress+"%",this.elements.divUploadProgress.style.display="block"),window.submitLinkStore.state.featuredImageUri&&window.submitLinkStore.state.featuredImageUri.length>0&&(this.elements.imgImage.setAttribute("src",DiggUtils.stripHtml(window.submitLinkStore.state.featuredImageUri)),this.elements.inputImageUri.value=DiggUtils.stripHtml(window.submitLinkStore.state.featuredImageUri),this.elements.divImageDropArea.classList.add("submit-link-form__image-drop-area--has-image")),window.submitLinkStore.state.title&&window.submitLinkStore.state.title.trim().length>0?(this.elements.previewTitle.innerHTML=DiggUtils.stripHtml(window.submitLinkStore.state.title),this.elements.inputTitle.value=DiggUtils.stripHtml(window.submitLinkStore.state.title)):this.elements.previewTitle.innerHTML=DiggUtils.stripHtml(this.elements.inputTitle.placeholder),window.submitLinkStore.state.kicker&&window.submitLinkStore.state.kicker.trim().length>0?this.elements.previewKicker.innerHTML=DiggUtils.stripHtml(window.submitLinkStore.state.kicker):this.elements.previewKicker.innerHTML=DiggUtils.stripHtml(this.elements.inputKicker.placeholder),window.submitLinkStore.state.uri&&window.submitLinkStore.state.uri.trim().length>0?this.elements.previewUri.innerHTML=DiggUtils.extractHostname(DiggUtils.stripHtml(window.submitLinkStore.state.uri)):this.elements.previewUri.innerHTML=DiggUtils.extractHostname(DiggUtils.stripHtml(this.elements.inputUri.placeholder)),window.submitLinkStore.state.description&&window.submitLinkStore.state.description.trim().length>0?(this.elements.previewDescription.innerHTML=DiggUtils.stripHtml(window.submitLinkStore.state.description),this.elements.inputDescription.value=DiggUtils.stripHtml(window.submitLinkStore.state.description)):this.elements.previewDescription.innerHTML=DiggUtils.stripHtml(this.elements.inputDescription.placeholder)}destroyCropper(){this.featuredImageCropper&&this.featuredImageCropper.destroy()}saveCroppedImage(){if(this.featuredImageCropper){this.featuredImageCropper.getCroppedCanvas().toBlob(e=>{window.submitLinkStore.dispatch("setFeaturedImageFileBlob",e),window.submitLinkStore.dispatch("setFeaturedImageUploadProgress",0)})}}handleFileUpload(e){window.submitLinkStore.dispatch("setFeaturedImageFile",e),window.submitLinkStore.dispatch("setFeaturedImageUploadProgress",0)}initializeCropper(){window.submitLinkStore.dispatch("setFeaturedImageCroppingStatus",!0),this.featuredImageCropper&&this.featuredImageCropper.destroy(),this.featuredImageCropper=new Cropper(this.elements.imgImage,{checkCrossOrigin:!1,aspectRatio:35/19}),this.imageDropAreaDisableClick()}imageDropAreaDisableClick(){this.elements.divImageDropArea.addEventListener("click",this.stopDefaultAndPropagation)}imageDropAreaEnableClick(){this.elements.divImageDropArea.removeEventListener("click",this.stopDefaultAndPropagation)}stopDefaultAndPropagation(e){e.preventDefault(),e.stopPropagation()}validateUri(){let e=0;this.elements.inputUri.classList.remove("error");const t=this.elements.inputUri.value.trim();return 0===t.length||this.elements.inputUri.value===this.elements.inputUri.getAttribute("placeholder")?(e++,this.elements.inputUri.classList.add("error")):isUrl(t)||(e++,this.elements.inputUri.classList.add("error")),e}validateTitle(){let e=0;return this.elements.inputTitle.classList.remove("error"),0!==this.elements.inputTitle.value.trim().length&&this.elements.inputTitle.value!==this.elements.inputTitle.getAttribute("placeholder")||(e++,this.elements.inputTitle.classList.add("error")),e}validateKicker(){return this.elements.inputKicker.classList.remove("error"),0}validateDescription(){let e=0;return this.elements.inputDescription.classList.remove("error"),0!==this.elements.inputDescription.value.trim().length&&this.elements.inputDescription.value!==this.elements.inputDescription.getAttribute("placeholder")||(e++,this.elements.inputDescription.classList.add("error")),e}validateForm(){let e=0;return e+=this.validateTitle(),e+=this.validateUri(),e+=this.validateKicker(),e+=this.validateDescription(),0===e}}const o=(e,t)=>{const i={uri:window.submittedLink.uri,title:window.submittedLink.title,kicker:window.submittedLink.kicker,description:window.submittedLink.description,lede:window.submittedLink.lede,points:window.submittedLink.points,socialLink:window.submittedLink.socialLink,featuredImageUri:window.submittedLink.featuredImageUri,featuredImageUploadProgress:-1,featuredImageCroppingStatus:!1,validating:!1,namespaceSlug:window.submittedLink.namespaceSlug,hashId:window.submittedLink.hashId};window.submitLinkStore=new FsmStore({actions:e,mutations:t,state:i});(new s).render()};t.getSubmittedLink(window.submittedLink.hashId).then(e=>e.json()).then(t=>{t?(t.points?t.points=t.points.join("\n"):t.points="",t.socialLink&&t.socialLink.path&&t.socialLink.path.url?t.socialLink=t.socialLink.path.url:t.socialLink="",window.submittedLink=t,o(n,i)):(window.submittedLink.uri="",window.submittedLink.title="",window.submittedLink.kicker="",window.submittedLink.description="",window.submittedLink.lede="",window.submittedLink.points="",window.submittedLink.socialLink="",window.submittedLink.featuredImageUri="",window.userStory&&window.userStory.id?e.getUserStory(window.userStory.id).then(e=>e.json()).then(e=>{e&&(window.submittedLink.uri="https://digg.com"+e.fullSlug,window.submittedLink.title=""+e.title,window.submittedLink.kicker=""+e.kicker,window.submittedLink.description=""+e.intro,window.submittedLink.featuredImageUri=""+e.featuredImageUri),o(n,i)}):o(n,i))})}})(),(()=>{document.querySelectorAll(".moderation-user-stories .change-user").forEach(t=>{t.addEventListener("click",t=>{e(t.currentTarget),t.preventDefault()})});const e=function(e){const n=e.closest(".created").querySelector(".user"),o=e.closest(".created").querySelector(".cancel-change");if(n)if(n.getAttribute("contenteditable")&&!1!==n.getAttribute("contenteditable")&&"false"!==n.getAttribute("contenteditable")){const e=n.getAttribute("data-user-id"),t=n.getAttribute("data-story-id");fetch("/api/user-story/change-author",{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify({storyId:t,authorId:e})}).then(e=>e.json()).then(e=>{s(o.closest(".created"))})}else n.setAttribute("contenteditable",!0),n.classList.add("editable"),e.innerText="Save?",o.style.display="inline-block",n.focus(),document.execCommand("selectAll",!1,null),o.addEventListener("click",e=>{t(e.currentTarget),e.preventDefault()}),i(n)},t=function(e){e.closest(".created").querySelector(".change-user");const t=e.closest(".created").querySelector(".user");s(e.closest(".created"));const i=t.getAttribute("data-user-displayname");t.innerText=i},i=function(e){let t=null;e.addEventListener("keyup",e=>{clearTimeout(t);const i=e.currentTarget,s=i.closest(".user-wrap").querySelector(".user-list"),o=i.innerText.toLowerCase();s.innerHTML="",s.style.display="none",t=setTimeout(()=>{o&&fetch("/api/user/authors?term="+o).then(e=>e.json()).then(e=>{e&&e.forEach(e=>{if(!s.querySelector(`[data-user-id="${e.id}"]`)){"none"===s.style.display&&(s.style.display="block");const t=document.createElement("div");t.setAttribute("data-user-id",e.id),t.innerText=e.displayName,s.append(t),t.addEventListener("click",e=>{n(e.currentTarget),e.preventDefault()})}})})},200)})},n=e=>{if(e){const t=e.closest(".created").querySelector(".user"),i=(t.getAttribute("data-user-id"),e.innerText),n=e.getAttribute("data-user-id"),s=e.closest(".created").querySelector(".user-list");t.innerText=i,t.setAttribute("data-user-id",n),s.innerHTML="",s.style.display="none"}},s=e=>{if(e){const t=e.querySelector(".user"),i=e.querySelector(".change-user"),n=e.querySelector(".cancel-change"),s=e.querySelector(".user-list");t.setAttribute("contenteditable",!1),t.classList.remove("editable"),i.innerText="Change author?",n.style.display="none",window.getSelection().removeAllRanges(),s.innerHTML="",s.style.display="none"}},o={set(e,t,i){const n={value:t,expires_at:(new Date).getTime()+1e3*i/1};localStorage.setItem(e.toString(),JSON.stringify(n))},get(e){const t=JSON.parse(localStorage.getItem(e.toString()));if(null!==t){if(!(null!==t.expires_at&&t.expires_at<(new Date).getTime()))return t.value;localStorage.removeItem(e.toString())}return null}},a=document.querySelectorAll(".story-earnings");a&&a.forEach(async e=>{const t=`earnings_${e.dataset.id}_43200`,i=o.get(t);if(i)e.querySelector(".pageViews").innerText=i.data.pageViews;else{const i=await fetch("/api/clicky?path="+e.dataset.href),n=await i.json();n.data&&(o.set(t,n,43200),e.querySelector(".pageViews").innerText=n.data.pageViews)}})})(),(()=>{const e=e=>{const t=document.querySelectorAll(".namespace-comments .operations .actions");e.target.classList.contains("action-icon")||t.forEach(e=>{e.classList.remove("show")})},t=document.querySelector(".filter-comments"),i=document.querySelector(".flagged-comments");t&&i&&t.addEventListener("keyup",e=>{const t=i.querySelectorAll(".comment-container"),n=e.target.value.toLowerCase();t.forEach(e=>{const t=e,i=[];i.push(e.querySelector("h5").innerText.toLowerCase()),i.push(e.querySelector(".contents").innerText.toLowerCase()),i.push(e.querySelector(".by").innerText.toLowerCase()),0===n.length?t.style.display="block":(t.style.display="none",i.join(" ").indexOf(n)>=0&&(t.style.display="block"))})});const n=e=>{e.addEventListener("click",t=>{const i=encodeURI(e.dataset.href);confirm("Do you really want to unflag this comment?")&&(window.location.href=i),t.preventDefault()})},s=e=>{e.addEventListener("click",t=>{const i=encodeURI(e.dataset.href);confirm("Do you really want to flag this comment?")&&(window.location.href=i),t.preventDefault()})},o=e=>{e.addEventListener("click",t=>{const i=encodeURI(e.dataset.href);confirm("Do you really want to delete this comment?")&&(window.location.href=i),t.preventDefault()})},a=e=>{e.addEventListener("click",t=>{const i=encodeURI(e.dataset.href);confirm("Do you really want to mark this comment as spam?")&&(window.location.href=i),t.preventDefault()})},r=e=>{e.addEventListener("click",t=>{const i=encodeURI(e.dataset.href);confirm("Do you really want to unspam this comment?")&&(window.location.href=i),t.preventDefault()})},l=e=>{e.addEventListener("click",t=>{const i=encodeURI(e.dataset.href);confirm("Do you really want to mark this user and all their submitted content as spam?")&&(window.location.href=i),t.preventDefault()})},c=e=>{e.addEventListener("click",e=>{const t=document.querySelectorAll(".namespace-comments .operations .actions"),i=e.target.parentNode.querySelector(".actions"),n=i.classList.contains("show");t.forEach(e=>{e.classList.remove("show")}),n?i.classList.remove("show"):i.classList.add("show")})},m=document.querySelectorAll(".namespace-comments .operations svg");m&&(m.forEach(e=>c(e)),document.body.removeEventListener("click",e),document.body.addEventListener("click",t=>e(t)));const d=e=>{document.querySelectorAll(".namespace-comments .comments-commands .cmd-selected span").forEach(t=>{t.innerHTML=`(${e})`})},u=document.querySelector(".namespace-comments .select-all-comments-checkbox");u&&u.addEventListener("click",e=>{const t=document.querySelectorAll(".namespace-comments .comments-commands ul li:not(.always-visible)");u.checked?t.forEach(e=>{e.classList.add("active")}):t.forEach(e=>{e.classList.remove("active")});document.querySelectorAll('.namespace-comments .item input[type="checkbox"]').forEach(e=>{e.checked=u.checked});const i=document.querySelectorAll('.namespace-comments .item input[type="checkbox"]:checked');d(i.length)});const p=document.querySelector(".namespace-comments .comments-commands .cmd-delete-selected");p&&(e=>{const t=document.querySelector(".namespace-comments .comments-commands ul");if(t){const i=t.dataset.href,{namespaceSlug:n}=t.dataset;e.addEventListener("click",e=>{const t=document.querySelectorAll('.namespace-comments .item input[type="checkbox"]:checked');if(confirm("Do you really want to delete these comments?")){const e=[];t.forEach(t=>{e.push(t.value)}),fetch("/api/comment/bulk-delete",{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify({namespaceSlug:n,ids:e})}).then(e=>{window.location.href=i}).catch(e=>{console.log(e)})}e.preventDefault()})}})(p);const h=e=>{const t=document.querySelectorAll(".namespace-comments .comments-commands ul li:not(.always-visible)");t&&e.addEventListener("click",e=>{const i=document.querySelectorAll('.namespace-comments .item input[type="checkbox"]:checked');d(i.length),t.forEach(e=>{i&&i.length>0?e.classList.add("active"):e.classList&&e.classList.remove("active")})})},g=document.querySelectorAll('.namespace-comments .item input[type="checkbox"]');g&&g.forEach(e=>{h(e)});const k=document.querySelectorAll(".namespace-comments .operations .actions .unflag");k&&k.forEach(e=>n(e));const w=document.querySelectorAll(".namespace-comments .operations .actions .flag");w&&w.forEach(e=>s(e));const y=document.querySelectorAll(".namespace-comments .operations .actions .delete");y&&y.forEach(e=>o(e));const b=document.querySelectorAll(".namespace-comments .operations .actions .unspam");b&&b.forEach(e=>r(e));const v=document.querySelectorAll(".namespace-comments .operations .actions .spam");v&&v.forEach(e=>a(e));const S=document.querySelectorAll(".namespace-comments .operations .actions .spamuser");S&&S.forEach(e=>l(e)),window.addEventListener("commentLoaded",t=>{const i=document.querySelector(`[data-id="${t.detail.commentId}"]`);if(i){const t=i.querySelector(".operations svg");if(t){c(t);const m=i.querySelector(".operations .actions .delete");m&&o(m);const d=i.querySelector(".operations .actions .unspam");d&&r(d);const u=i.querySelector(".operations .actions .spam");u&&a(u);const p=i.querySelector(".operations .actions .flag");p&&s(p);const g=i.querySelector(".operations .actions .unflag");g&&n(g);const k=i.querySelector(".operations .actions .spamuser");k&&l(k);const w=i.querySelector(".select-comment-checkbox");w&&h(w),document.body.removeEventListener("click",e),document.body.addEventListener("click",t=>e(t))}}});const f=document.querySelector(".namespace-comments .comments-commands .cmd-special-empty-spam");f&&(e=>{const t=document.querySelector(".namespace-comments .comments-commands ul");if(t){const i=t.dataset.href,{namespaceSlug:n}=t.dataset;e.addEventListener("click",e=>{confirm("Do you really want to empty the spam folder and delete all spam comments?")&&fetch("/api/comment/empty-spam-folder",{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify({namespaceSlug:n})}).then(e=>{window.location.href=i}).catch(e=>{console.log(e)}),e.preventDefault()})}})(f);const L=document.querySelector(".namespace-comments .comments-commands .cmd-special-empty-flagged");L&&(e=>{const t=document.querySelector(".namespace-comments .comments-commands ul");if(t){const i=t.dataset.href,{namespaceSlug:n}=t.dataset;e.addEventListener("click",e=>{confirm("Do you really want to empty the flagged folder and delete all flagged comments?")&&fetch("/api/comment/empty-flagged-folder",{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify({namespaceSlug:n})}).then(e=>{window.location.href=i}).catch(e=>{console.log(e)}),e.preventDefault()})}})(L);const D=document.querySelector(".namespace-comments .comments-commands .cmd-spam-selected");D&&(e=>{const t=document.querySelector(".namespace-comments .comments-commands ul");if(t){const i=t.dataset.href,{namespaceSlug:n}=t.dataset;e.addEventListener("click",e=>{const t=document.querySelectorAll('.namespace-comments .item input[type="checkbox"]:checked');if(confirm("Do you really want to spam these comments?")){const e=[];t.forEach(t=>{e.push(t.value)}),fetch("/api/comment/bulk-spam",{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify({namespaceSlug:n,ids:e})}).then(e=>{window.location.href=i}).catch(e=>{console.log(e)})}e.preventDefault()})}})(D);const I=document.querySelector(".namespace-comments .comments-commands .cmd-spam-users-selected");I&&(e=>{const t=document.querySelector(".namespace-comments .comments-commands ul");if(t){const i=t.dataset.href,{namespaceSlug:n}=t.dataset;e.addEventListener("click",e=>{const t=document.querySelectorAll('.namespace-comments .item input[type="checkbox"]:checked');if(confirm("Do you really want to mark these users as spammers?")){const e=[];t.forEach(t=>{e.push(t.value)}),fetch("/api/comment/bulk-spam-users",{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify({namespaceSlug:n,ids:e})}).then(e=>{window.location.href=i}).catch(e=>{console.log(e)})}e.preventDefault()})}})(I);const C=document.querySelector(".namespace-comments .comments-commands .cmd-unspam-selected");C&&(e=>{const t=document.querySelector(".namespace-comments .comments-commands ul");if(t){const i=t.dataset.href,{namespaceSlug:n}=t.dataset;e.addEventListener("click",e=>{const t=document.querySelectorAll('.namespace-comments .item input[type="checkbox"]:checked');if(confirm("Do you really want to unspam these comments?")){const e=[];t.forEach(t=>{e.push(t.value)}),fetch("/api/comment/bulk-unspam",{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify({namespaceSlug:n,ids:e})}).then(e=>{window.location.href=i}).catch(e=>{console.log(e)})}e.preventDefault()})}})(C)})(),(()=>{if(document.querySelector(".wrapper .namespace-create")){let e=new FsmStore({actions:{setName(e,t){e.commit("setName",t)},setSlug(e,t){e.commit("setSlug",t)},setValidating(e,t){e.commit("setValidating",t)}},mutations:{setSlug:(e,t)=>(e.slug=t,e),setName:(e,t)=>(e.name=t,e),setValidating:(e,t)=>(e.validating=t,e)},state:{name:"",slug:"",validating:!1}});class t extends FsmComponent{constructor(){super({store:e,elements:{divWrapperNamespaceCreate:document.querySelector(".namespace-create"),divThankYou:document.querySelector(".namespace-create__thank-you"),divNamespaceExists:document.querySelector(".namespace-create__exists"),btnSubmit:document.querySelector(".namespace-create-form__btn"),divNamespaceForm:document.querySelector(".namespace-create-form"),inputName:document.querySelector(".namespace-create-form .namespace-create-form__name"),inputSlug:document.querySelector(".namespace-create-form .namespace-create-form__slug")}}),this.elements.inputName.addEventListener("blur",t=>{0===this.validateName()&&e.dispatch("setName",this.elements.inputName.value)}),this.elements.inputSlug.addEventListener("blur",t=>{0===this.validateSlug()&&e.dispatch("setSlug",this.elements.inputSlug.value)}),this.elements.btnSubmit.addEventListener("click",t=>{e.dispatch("setValidating",!0),this.validateForm()&&(e.dispatch("setValidating",!1),namespaceCreateFormProxy.getNamespace(e.state.slug).then(e=>e.json()).then(t=>{t?(this.elements.divNamespaceForm.style.display="none",this.elements.divNamespaceExists.style.display="block"):(this.elements.divNamespaceForm.style.display="none",this.elements.divThankYou.style.display="block",namespaceCreateFormProxy.createNamespace(e).then(t=>{window.location=`/${e.state.slug}/edit`}).catch(e=>{console.log(e)}))}).catch(e=>{console.log(e)})),t.preventDefault()})}render(){e.state.name.trim().length>0&&(this.elements.inputName.value=DiggUtils.stripHtml(e.state.name)),e.state.slug.trim().length>0&&(this.elements.inputSlug.value=DiggUtils.stripHtml(e.state.slug))}validateName(){let e=0;return this.elements.inputName.classList.remove("error"),0===this.elements.inputName.value.trim().length&&(e++,this.elements.inputName.classList.add("error")),e}validateSlug(){let e=0;return this.elements.inputSlug.classList.remove("error"),0===this.elements.inputSlug.value.trim().length&&(e++,this.elements.inputSlug.classList.add("error")),this.elements.inputSlug.value=this.elements.inputSlug.value.replace(/ /g,"-"),this.elements.inputSlug.value=this.elements.inputSlug.value.replace(/[^0-9a-z\-]/gi,""),this.elements.inputSlug.value=this.elements.inputSlug.value.toLowerCase(),e}validateForm(){let e=0;return e+=this.validateName(),e+=this.validateSlug(),0===e}}(new t).render()}})();const namespaceCreateFormProxy={createNamespace:e=>fetch("/namespaces/new",{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify({name:e.state.name,slug:e.state.slug})}),getNamespace:e=>fetch("/api/namespace/"+e)};(()=>{if(document.querySelector(".wrapper .namespace-edit")){const e={setSocialImageUri:(e,t)=>(e.socialImageUri=t,e),setName:(e,t)=>(e.name=t,e),setDescription:(e,t)=>(e.description=t,e),setPrimaryColor:(e,t)=>(e.primaryColor=t,e),setSecondaryColor:(e,t)=>(e.secondaryColor=t,e),setDisableComments:(e,t)=>(e.disableComments=t,e),setExcludedFromDirectory:(e,t)=>(e.excludedFromDirectory=t,e),setDisabled:(e,t)=>(e.disabled=t,e),setCommentsDefaultDisabled:(e,t)=>(e.commentsDefaultDisabled=t,e),setValidating:(e,t)=>(e.validating=t,e),setSocialImageUploadProgress:(e,t)=>(e.socialImageUploadProgress=t,e),setSocialImageCroppingStatus:(e,t)=>(e.socialImageCroppingStatus=t,e),setSocialImageFinishedUploading:(e,t)=>(e.socialImageFinishedUploading=t,e),setOwners:(e,t)=>(e.owners=t,e),setAutosuggestUsers:(e,t)=>(e.autosuggestUsers=t,e)},t={setName(e,t){e.commit("setName",t)},setDescription(e,t){e.commit("setDescription",t)},setPrimaryColor(e,t){e.commit("setPrimaryColor",t)},setSecondaryColor(e,t){e.commit("setSecondaryColor",t)},setDisableComments(e,t){e.commit("setDisableComments",t)},setDisabled(e,t){e.commit("setDisabled",t)},setExcludedFromDirectory(e,t){e.commit("setExcludedFromDirectory",t)},setCommentsDefaultDisabled(e,t){e.commit("setCommentsDefaultDisabled",t)},setValidating(e,t){e.commit("setValidating",t)},setSocialImageFileBlob(e,t){namespaceEditFormProxy.saveSocialImage(n,t).then(t=>{let i=JSON.parse(t);i.hasOwnProperty("success")&&"1"===i.success?(e.commit("setSocialImageUri",i.embed.imageUrl),e.dispatch("setSocialImageCroppingStatus",!1)):console.log(t)}).catch(e=>{console.log(e)})},setSocialImageFile(e,t){namespaceEditFormProxy.saveSocialImage(n,t).then(t=>{let i=JSON.parse(t);i.hasOwnProperty("success")&&"1"===i.success?(e.commit("setSocialImageUri",i.embed.imageUrl),e.dispatch("setSocialImageFinishedUploading",!0)):console.log(t)}).catch(e=>{console.log(e)})},setSocialImageUploadProgress(e,t){e.commit("setSocialImageUploadProgress",t)},setSocialImageCroppingStatus(e,t){e.commit("setSocialImageCroppingStatus",t)},setSocialImageFinishedUploading(e,t){e.commit("setSocialImageFinishedUploading",t)},addOwner(e,t){namespaceEditFormProxy.addOwner(n.state.id,n.state.slug,t).then(t=>{namespaceEditFormProxy.getOwners(n.state.id).then(e=>e.json()).then(t=>{e.commit("setOwners",t)}).catch(e=>{console.log(e)})}).catch(e=>{console.log(e)})},hideOwner(e,t){namespaceEditFormProxy.hideOwner(n.state.id,n.state.slug,t).then(i=>{newOwners=n.state.owners,newOwners.forEach(e=>{e.userid===t&&(e.hidden=!0)}),e.commit("setOwners",newOwners)}).catch(e=>{console.log(e)})},unHideOwner(e,t){namespaceEditFormProxy.unHideOwner(n.state.id,n.state.slug,t).then(i=>{newOwners=n.state.owners,newOwners.forEach(e=>{e.userid===t&&(e.hidden=!1)}),e.commit("setOwners",newOwners)}).catch(e=>{console.log(e)})},removeOwner(e,t){namespaceEditFormProxy.removeOwner(n.state.id,n.state.slug,t).then(i=>{let s=n.state.owners.filter(e=>e.userid!=t);e.commit("setOwners",s)}).catch(e=>{console.log(e)})},findUsers(e,t){namespaceEditFormProxy.findUsers(t).then(e=>e.json()).then(t=>{e.commit("setAutosuggestUsers",t)}).catch(e=>{console.log(e)})}};let i={id:window.namespace.id,slug:window.namespace.slug,name:window.namespace.name?window.namespace.name:"",description:window.namespace.description?window.namespace.description:"",disableComments:!!window.namespace.disableComments&&window.namespace.disableComments,commentsDefaultDisabled:!!window.namespace.commentsDefaultDisabled&&window.namespace.commentsDefaultDisabled,disabled:!!window.namespace.disabled&&window.namespace.disabled,excludedFromDirectory:!!window.namespace.excludedFromDirectory&&window.namespace.excludedFromDirectory,socialImageUri:window.namespace.socialImageUri?window.namespace.socialImageUri:"",socialImageUploadProgress:-1,socialImageCroppingStatus:!1,socialImageFinishedUploading:!1,validating:!1,owners:window.namespace.owners?window.namespace.owners:[],autosuggestUsers:[],primaryColor:window.namespace.primaryColor?window.namespace.primaryColor:"",secondaryColor:window.namespace.secondaryColor?window.namespace.secondaryColor:""},n=new FsmStore({actions:t,mutations:e,state:i});class s extends FsmComponent{constructor(){if(super({store:n,elements:{divWrapperNamespaceEdit:document.querySelector(".namespace-edit"),divThankYou:document.querySelector(".namespace-edit__thank-you"),divNamespaceForm:document.querySelector(".namespace-edit-form"),divNamespacePreview:document.querySelector(".namespace-sidebar"),btnSubmit:document.querySelector(".namespace-edit-form__btn"),inputExcludedFromDirectory:document.querySelector("#namespace-edit-form__excluded-from-directory"),inputDisableNamespace:document.querySelector("#namespace-edit-form__disabled"),inputDisableComments:document.querySelector("#namespace-edit-form__disable-comments"),inputCommentsDefaultDisabled:document.querySelector("#namespace-edit-form__comments-default-disabled"),labelCommentsDefaultDisabled:document.querySelector('label[for="namespace-edit-form__comments-default-disabled"]'),inputName:document.querySelector(".namespace-edit-form .namespace-edit-form__name"),inputDescription:document.querySelector(".namespace-edit-form .namespace-edit-form__description"),inputNamespaceId:document.querySelector("#namespace-edit-form__namespace-id"),inputNamespaceSlug:document.querySelector("#namespace-edit-form__namespace-slug"),previewName:document.querySelector(".namespace-sidebar .namespace-sidebar__name"),previewDescription:document.querySelector(".namespace-sidebar .namespace-sidebar__description"),inputFindUser:document.querySelector(".namespace-edit-form__find-user"),tableTbodyOwners:document.querySelector(".namespace-edit-form__panel-owners table tbody"),tableTbodyAutosuggestUsers:document.querySelector(".namespace-edit-form__autosuggest-users table tbody"),inputSocialShareImageHidden:document.querySelector("#namespace-edit-form__social-image-uri"),divImageDropArea:document.querySelector(".namespace-edit-form__image-drop-area"),inputSocialShareImage:document.querySelector("#namespace-edit-form__social-image-input"),imgSocialShareImage:document.querySelector(".namespace-edit-form__image-wrap img"),divUploadProgress:document.querySelector(".namespace-edit-form__upload-progress"),aCropCommand:document.querySelector(".namespace-edit-form__crop-command"),aCropFinishCommand:document.querySelector(".namespace-edit-form__crop-finish-command"),aCropCancelCommand:document.querySelector(".namespace-edit-form__crop-cancel-command"),inputPrimaryColor:document.querySelector(".namespace-edit-form__primary-color"),inputSecondaryColor:document.querySelector(".namespace-edit-form__secondary-color"),aRemoveOwnerCommands:document.querySelectorAll(".namespace-edit-form__owner-remove")}}),n.state.name.trim().length>0&&(this.elements.inputName.value=DiggUtils.stripHtml(n.state.name)),n.state.description.trim().length>0&&(this.elements.inputDescription.value=DiggUtils.stripHtml(n.state.description)),this.elements.inputName&&this.elements.previewName&&this.elements.inputName.addEventListener("blur",e=>{if(this.elements.inputName.value.trim().length>0||n.validating){this.validateName();let e=DiggUtils.stripHtml(this.elements.inputName.value.trim());0===e.length&&(e=DiggUtils.stripHtml(this.elements.inputName.placeholder)),n.dispatch("setName",e)}}),this.elements.inputDescription&&this.elements.previewDescription&&this.elements.inputDescription.addEventListener("blur",e=>{if(this.elements.inputDescription.value.trim().length>0||n.validating){this.validateDescription();let e=DiggUtils.stripHtml(this.elements.inputDescription.value.trim());0===e.length&&(e=DiggUtils.stripHtml(this.elements.inputDescription.placeholder.trim())),n.dispatch("setDescription",e)}}),this.elements.inputFindUser&&this.elements.inputFindUser.addEventListener("keyup",e=>{this.elements.inputFindUser.value.trim().length>2&&n.dispatch("findUsers",this.elements.inputFindUser.value)}),this.elements.aCropCancelCommand&&this.elements.aCropCancelCommand.addEventListener("click",e=>{n.dispatch("setSocialImageCroppingStatus",!1),""!==this.elements.imgSocialShareImage.getAttribute("src")&&(this.destroyCropper(),this.imageDropAreaEnableClick()),e.preventDefault()}),this.elements.aRemoveOwnerCommands)for(var e=0;e<this.elements.aRemoveOwnerCommands.length;e++){const t=this.elements.aRemoveOwnerCommands[e];this.bindRemoveOwnerClick(t)}this.elements.aCropCommand&&this.elements.aCropCommand.addEventListener("click",e=>{""!==this.elements.imgSocialShareImage.getAttribute("src")&&this.initializeCropper(),e.preventDefault()}),this.elements.aCropFinishCommand&&this.elements.aCropFinishCommand.addEventListener("click",e=>{""!==this.elements.imgSocialShareImage.getAttribute("src")&&(this.saveCroppedImage(),this.destroyCropper(),this.imageDropAreaEnableClick()),e.preventDefault()}),n.state.disableComments?this.elements.labelCommentsDefaultDisabled.style.display="none":this.elements.labelCommentsDefaultDisabled.style.display="block";let t=this;this.elements.inputDisableComments&&this.elements.inputDisableComments.addEventListener("change",(function(){n.dispatch("setDisableComments",this.checked),this.checked?(n.dispatch("setCommentsDefaultDisabled",!1),t.elements.labelCommentsDefaultDisabled.style.display="none"):t.elements.labelCommentsDefaultDisabled.style.display="block"})),this.elements.inputDisableNamespace&&this.elements.inputDisableNamespace.addEventListener("change",(function(){n.dispatch("setDisabled",this.checked)})),this.elements.inputPrimaryColor&&this.elements.inputPrimaryColor.addEventListener("blur",(function(){0===t.validateCssColorInput(t.elements.inputPrimaryColor)&&n.dispatch("setPrimaryColor",this.value)})),this.elements.inputSecondaryColor&&this.elements.inputSecondaryColor.addEventListener("blur",(function(){0===t.validateCssColorInput(t.elements.inputSecondaryColor)&&n.dispatch("setSecondaryColor",this.value)})),this.elements.inputExcludedFromDirectory&&this.elements.inputExcludedFromDirectory.addEventListener("change",(function(){n.dispatch("setExcludedFromDirectory",this.checked)})),this.elements.inputCommentsDefaultDisabled&&this.elements.inputCommentsDefaultDisabled.addEventListener("change",(function(){n.dispatch("setCommentsDefaultDisabled",this.checked)})),this.elements.inputSocialShareImage&&this.elements.inputSocialShareImage.addEventListener("change",()=>{this.handleFileUpload(this.elements.inputSocialShareImage.files[0])},!1),this.elements.divImageDropArea&&(this.elements.divImageDropArea.addEventListener("drop",e=>{if(!n.state.socialImageCroppingStatus){this.elements.divImageDropArea.classList.remove("namespace-edit-form__image-drop-area--highlight");let t=e.dataTransfer.files;this.handleFileUpload(t[0])}e.preventDefault(),e.stopPropagation()},!1),this.elements.divImageDropArea.addEventListener("dragenter",e=>{n.state.socialImageCroppingStatus||this.elements.divImageDropArea.classList.add("namespace-edit-form__image-drop-area--highlight"),e.preventDefault(),e.stopPropagation()},!1),this.elements.divImageDropArea.addEventListener("dragover",e=>{n.state.socialImageCroppingStatus||this.elements.divImageDropArea.classList.add("namespace-edit-form__image-drop-area--highlight"),e.preventDefault(),e.stopPropagation()},!1),this.elements.divImageDropArea.addEventListener("dragleave",e=>{this.elements.divImageDropArea.classList.remove("namespace-edit-form__image-drop-area--highlight"),e.preventDefault(),e.stopPropagation()},!1)),this.elements.divThankYou&&this.elements.divNamespaceForm&&this.elements.divNamespacePreview&&this.elements.btnSubmit&&this.elements.btnSubmit.addEventListener("click",e=>{n.dispatch("setValidating",!0),this.validateForm()&&(n.dispatch("setValidating",!1),this.elements.divNamespaceForm.style.display="none",this.elements.divThankYou.style.display="block",namespaceEditFormProxy.saveNamespace(n).then(e=>{}).catch(e=>{console.log(e)})),e.preventDefault()})}render(){n.state.socialImageCroppingStatus?this.elements.divImageDropArea.classList.add("namespace-edit-form__image-drop-area--cropping"):this.elements.divImageDropArea.classList.remove("namespace-edit-form__image-drop-area--cropping"),n.state.socialImageFinishedUploading&&(n.dispatch("setSocialImageFinishedUploading",!1),this.initializeCropper()),this.elements.tableTbodyAutosuggestUsers&&n.state.autosuggestUsers&&(this.elements.tableTbodyAutosuggestUsers.innerHTML="",n.state.autosuggestUsers.length>0&&n.state.autosuggestUsers.forEach((e,t)=>{const i=document.createElement("tr"),n=document.createElement("td");n.innerHTML=e.displayName;const s=document.createElement("td"),o=document.createElement("a");o.setAttribute("class","namespace-edit-form__owner-add"),o.setAttribute("data-id",e.userid),o.innerHTML="Add",s.appendChild(o),i.appendChild(n),i.appendChild(s),this.elements.tableTbodyAutosuggestUsers.appendChild(i),this.bindAddOwnerClick(o)})),this.elements.tableTbodyOwners&&n.state.owners&&(this.elements.tableTbodyOwners.innerHTML="",n.state.owners.forEach((e,t)=>{const i=document.createElement("tr"),n=document.createElement("td");n.innerHTML=e.displayName;const s=document.createElement("td");s.innerHTML=e.username;const o=document.createElement("td"),a=document.createElement("input");a.setAttribute("type","checkbox"),a.setAttribute("class","namespace-edit-form__owner-hidden"),e.hidden&&a.setAttribute("checked","checked"),a.setAttribute("data-id",e.userid),o.appendChild(a);const r=document.createElement("td"),l=document.createElement("a");l.setAttribute("class","namespace-edit-form__owner-remove"),l.setAttribute("data-id",e.userid),l.innerHTML="Remove",r.appendChild(l),i.appendChild(n),i.appendChild(s),i.appendChild(o),i.appendChild(r),this.elements.tableTbodyOwners.appendChild(i),this.bindHideUnHideOwnerClick(a),this.bindRemoveOwnerClick(l)})),n.state.socialImageUploadProgress<=-1?this.elements.divUploadProgress.style.display="none":(this.elements.divUploadProgress.style.width=n.state.socialImageUploadProgress+"%",this.elements.divUploadProgress.style.display="block"),n.state.socialImageUri&&n.state.socialImageUri.length>0&&(this.elements.imgSocialShareImage.setAttribute("src",DiggUtils.stripHtml(n.state.socialImageUri)),this.elements.inputSocialShareImageHidden.value=DiggUtils.stripHtml(n.state.socialImageUri),this.elements.divImageDropArea.classList.add("namespace-edit-form__image-drop-area--has-image")),n.state.primaryColor.trim().length>0&&(this.elements.inputPrimaryColor.value=DiggUtils.stripHtml(n.state.primaryColor)),n.state.secondaryColor.trim().length>0&&(this.elements.inputSecondaryColor.value=DiggUtils.stripHtml(n.state.secondaryColor)),n.state.name.trim().length>0?this.elements.previewName.innerHTML=DiggUtils.stripHtml(n.state.name):this.elements.previewName.innerHTML=DiggUtils.stripHtml(this.elements.inputName.placeholder),n.state.description.trim().length>0?this.elements.previewDescription.innerHTML=DiggUtils.stripHtml(n.state.description):this.elements.previewDescription.innerHTML=DiggUtils.stripHtml(this.elements.inputDescription.placeholder)}destroyCropper(){this.socialImageCropper&&this.socialImageCropper.destroy()}saveCroppedImage(){if(this.socialImageCropper){this.socialImageCropper.getCroppedCanvas().toBlob((function(e){n.dispatch("setSocialImageFileBlob",e),n.dispatch("setSocialImageUploadProgress",0)}))}}bindHideUnHideOwnerClick(e){e.addEventListener("click",t=>{e.checked?n.dispatch("hideOwner",e.dataset.id):n.dispatch("unHideOwner",e.dataset.id),t.preventDefault()})}bindRemoveOwnerClick(e){e.addEventListener("click",e=>{n.dispatch("removeOwner",e.target.dataset.id),e.preventDefault()})}bindAddOwnerClick(e){e.addEventListener("click",e=>{n.dispatch("addOwner",e.target.dataset.id),e.preventDefault()})}handleFileUpload(e){n.dispatch("setSocialImageFile",e),n.dispatch("setSocialImageUploadProgress",0)}isCssColor(e){const t=(new Option).style;return t.color=e,""!==t.color}initializeCropper(){n.dispatch("setSocialImageCroppingStatus",!0),this.socialImageCropper&&this.socialImageCropper.destroy(),this.socialImageCropper=new Cropper(this.elements.imgSocialShareImage,{checkCrossOrigin:!1,aspectRatio:35/19}),this.imageDropAreaDisableClick()}imageDropAreaDisableClick(){this.elements.divImageDropArea.addEventListener("click",this.stopDefaultAndPropagation)}imageDropAreaEnableClick(){this.elements.divImageDropArea.removeEventListener("click",this.stopDefaultAndPropagation)}stopDefaultAndPropagation(e){e.preventDefault(),e.stopPropagation()}validateName(){let e=0;return this.elements.inputName.classList.remove("error"),0===this.elements.inputName.value.trim().length&&(e++,this.elements.inputName.classList.add("error")),e}validateCssColorInput(e){let t=0;return e.classList.remove("error"),e.value.trim().length>0&&!this.isCssColor(e.value)&&(t++,e.classList.add("error")),t}validateDescription(){let e=0;return this.elements.inputDescription.classList.remove("error"),0===this.elements.inputDescription.value.trim().length&&(e++,this.elements.inputDescription.classList.add("error")),e}validateForm(){let e=0;return e+=this.validateName(),e+=this.validateDescription(),e+=this.validateCssColorInput(this.elements.inputPrimaryColor),e+=this.validateCssColorInput(this.elements.inputSecondaryColor),0===e}}(new s).render()}})();const namespaceEditFormProxy={saveSocialImage:(e,t)=>new Promise((function(i,n){var s=new FormData;s.append("socialImageFile",t);var o=new XMLHttpRequest;o.open("post",`/${e.state.slug}/edit/upload-social-image`,!0),o.upload.onprogress=function(t){t.lengthComputable&&e.dispatch("setSocialImageUploadProgress",t.loaded/t.total*100)},o.upload.addEventListener("timeout",(function(e){n({status:this.status,statusText:o.statusText})})),o.addEventListener("loadend",t=>{e.dispatch("setSocialImageUploadProgress",-1)},!1),o.addEventListener("readystatechange",(function(e){4===this.readyState&&i(o.response)})),o.onerror=function(e){n({status:this.status,statusText:o.statusText})},o.send(s)})),saveNamespace:e=>fetch(`/${e.state.slug}/edit`,{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify({namespaceId:e.state.id,name:e.state.name,description:e.state.description,socialImageUri:e.state.socialImageUri,disableComments:e.state.disableComments,disabled:e.state.disabled,excludedFromDirectory:e.state.excludedFromDirectory,commentsDefaultDisabled:e.state.commentsDefaultDisabled,primaryColor:e.state.primaryColor,secondaryColor:e.state.secondaryColor})}),unHideOwner:(e,t,i)=>fetch(`/${t}/unhide-owner`,{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify({ownerId:i,namespaceId:e})}),hideOwner:(e,t,i)=>fetch(`/${t}/hide-owner`,{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify({ownerId:i,namespaceId:e})}),removeOwner:(e,t,i)=>fetch(`/${t}/remove-owner`,{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify({ownerId:i,namespaceId:e})}),addOwner:(e,t,i)=>fetch(`/${t}/add-owner`,{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify({ownerId:i,namespaceId:e})}),getOwners:e=>fetch(`/api/namespace/${e}/owners`),findUsers:e=>fetch("/api/user/find?term="+e)};(()=>{const e=i=>{const n=i.target,s=n.dataset.type,o=n.closest(".submitted-link-card"),a=n.parentNode.querySelector(".score"),r=n.parentNode.querySelector(".digg");fetch(`/api/namespace/digg/${o.dataset.id}?type=${s}`).then(e=>e.json()).then((function(e){const t=parseInt(a.innerText||0,10)+1;a.innerText=t,r.innerText="- digg"})),r.removeEventListener("click",e),r.addEventListener("click",t),r.classList.remove("digg"),r.classList.add("undigg"),i.preventDefault()},t=i=>{const n=i.target,s=n.dataset.type,o=n.closest(".submitted-link-card"),a=n.parentNode.querySelector(".score"),r=n.parentNode.querySelector(".undigg");fetch(`/api/namespace/undigg/${o.dataset.id}?type=${s}`).then(e=>e.json()).then((function(e){const t=parseInt(a.innerText||0,10)-1;a.innerText=t,r.innerText="+ digg"})),r.removeEventListener("click",t),r.addEventListener("click",e),r.classList.remove("undigg"),r.classList.add("digg"),i.preventDefault()};document.querySelectorAll(".submitted-link-card .card-link").forEach(e=>{e.dataset.href&&e.addEventListener("click",e=>{let t=e.currentTarget.dataset.href;t&&(window.open(t,"_blank"),e.preventDefault())})});document.querySelectorAll(".submitted-link-card .upvote .digg").forEach(t=>{t.addEventListener("click",e)});document.querySelectorAll(".submitted-link-card .upvote .undigg").forEach(e=>{e.addEventListener("click",t)})})();const hideAllShareNamespaceStoryMenus=()=>{const e=document.querySelectorAll(".share-namespace-story");if(e)for(const t of e)t.querySelector(".actions").style.display="none"},shareNamespaceStoryMenu=e=>{const t=e.parentNode.querySelector(".actions");"block"===t.style.display?t.style.display="none":(hideAllShareNamespaceStoryMenus(),t.style.display="block")},shareNamespaceStoryAction=e=>{const t=e.dataset.type;let i=e.dataset.href;const n=e.dataset.title;switch(isURL(i)||(i=window.location.origin+i),t){case"facebook":{let e=`https://www.facebook.com/sharer/sharer.php?u=redirect_uri=${encodeURI("https://digg.com")}&u=${encodeURI(i)}&display=popup`;window.open(e,window.diggTargetAttribute,"toolbar=no,width=550,height=500");break}case"twitter":{let e=`https://twitter.com/intent/tweet?url=${encodeURI(i)}&text=${encodeURI(n)}&via=Digg`;window.open(e,window.diggTargetAttribute,"toolbar=no,width=550,height=300");break}case"copy":var s=document.createElement("textarea");s.value=i,s.setAttribute("readonly",""),s.style={position:"absolute",left:"-9999px"},document.body.appendChild(s),s.select(),document.execCommand("copy"),document.body.removeChild(s)}hideAllShareNamespaceStoryMenus()};(()=>{const e=e=>{e.addEventListener("click",t=>{const i=encodeURI(e.dataset.href);confirm("Do you really want to delete this link?")&&(window.location.href=i)})},t=e=>{e.addEventListener("click",t=>{const i=encodeURI(e.dataset.href);confirm("Do you really want to mark this link as spam?")&&(window.location.href=i)})},i=e=>{e.addEventListener("click",t=>{const i=encodeURI(e.dataset.href);confirm("Do you really want to mark this user and all their submitted content as spam?")&&(window.location.href=i)})},n=e=>{e.addEventListener("click",e=>{const t=document.querySelectorAll(".namespace-inbox .operations .actions"),i=e.target.parentNode.querySelector(".actions"),n=i.classList.contains("show");t.forEach(e=>{e.classList.remove("show")}),n?i.classList.remove("show"):i.classList.add("show")})},s=e=>{const t=document.querySelectorAll(".namespace-inbox .operations .actions");e.target.classList.contains("action-icon")||t.forEach(e=>{e.classList.remove("show")})},o=document.querySelector(".filter-links"),a=document.querySelector(".submitted-links");o&&a&&o.addEventListener("keyup",e=>{const t=a.querySelectorAll(".item-container"),i=e.target.value.toLowerCase();t.forEach(e=>{const t=[];t.push(e.querySelector("h5").innerText.toLowerCase()),t.push(e.querySelector(".kicker").innerText.toLowerCase()),t.push(e.querySelector(".by").innerText.toLowerCase()),0===i.length||t.join(" ").indexOf(i)>=0?e.style.display="block":e.style.display="none"})});const r=document.querySelectorAll(".namespace-inbox .operations svg");r&&(r.forEach(e=>n(e)),document.body.removeEventListener("click",s),document.body.addEventListener("click",e=>s(e)));const l=e=>{document.querySelectorAll(".namespace-inbox .inbox-commands .cmd-selected span").forEach(t=>{t.innerHTML=`(${e})`})},c=e=>{const t=document.querySelectorAll(".namespace-inbox .inbox-commands ul li:not(.always-visible)");t&&e.addEventListener("click",e=>{const i=document.querySelectorAll('.namespace-inbox .item input[type="checkbox"]:checked');l(i.length),t.forEach(e=>{i&&i.length>0?e.classList.add("active"):e.classList&&e.classList.remove("active")})})};window.addEventListener("submittedLinkLoaded",o=>{const a=document.querySelector(`[data-id="${o.detail.hashId}"]`);if(a){const o=a.querySelector(".operations svg");if(o){n(o);const r=a.querySelector(".operations .actions .delete");r&&e(r);const l=a.querySelector(".operations .actions .spam");l&&t(l);const m=a.querySelector(".operations .actions .spamuser");m&&i(m);const d=a.querySelector(".select-submitted-link-checkbox");d&&c(d),document.body.removeEventListener("click",s),document.body.addEventListener("click",e=>s(e))}}});const m=document.querySelectorAll(".namespace-inbox .operations .actions .delete");m&&m.forEach(t=>e(t));const d=document.querySelectorAll(".namespace-inbox .operations .actions .spam");d&&d.forEach(e=>t(e));const u=document.querySelectorAll(".namespace-inbox .operations .actions .spamuser");u&&u.forEach(e=>i(e));const p=document.querySelector(".namespace-inbox .select-all-submitted-links-checkbox");p&&p.addEventListener("click",e=>{const t=document.querySelectorAll(".namespace-inbox .inbox-commands ul li:not(.always-visible)");p.checked?t.forEach(e=>{e.classList.add("active")}):t.forEach(e=>{e.classList.remove("active")});document.querySelectorAll('.namespace-inbox .item input[type="checkbox"]').forEach(e=>{e.checked=p.checked});const i=document.querySelectorAll('.namespace-inbox .item input[type="checkbox"]:checked');l(i.length)});const h=document.querySelectorAll('.namespace-inbox .item input[type="checkbox"]');h&&h.forEach(e=>{c(e)});const g=document.querySelector(".namespace-inbox .inbox-commands .cmd-delete-selected");g&&(e=>{const t=document.querySelector(".namespace-inbox .inbox-commands ul");if(t){const i=t.dataset.href,{namespaceSlug:n}=t.dataset;e.addEventListener("click",e=>{const t=document.querySelectorAll('.namespace-inbox .item input[type="checkbox"]:checked');if(confirm("Do you really want to delete these links?")){const e=[];t.forEach(t=>{e.push(t.value)}),fetch("/api/submitted-link/bulk-delete",{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify({namespaceSlug:n,ids:e})}).then(e=>{window.location.href=i}).catch(e=>{console.log(e)})}e.preventDefault()})}})(g);const k=document.querySelector(".namespace-inbox .inbox-commands .cmd-unspam-selected");k&&(e=>{const t=document.querySelector(".namespace-inbox .inbox-commands ul");if(t){const i=t.dataset.href,{namespaceSlug:n}=t.dataset;e.addEventListener("click",e=>{const t=document.querySelectorAll('.namespace-inbox .item input[type="checkbox"]:checked');if(confirm("Do you really want to unspam these links?")){const e=[];t.forEach(t=>{e.push(t.value)}),fetch("/api/submitted-link/bulk-unspam",{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify({namespaceSlug:n,ids:e})}).then(e=>{window.location.href=i}).catch(e=>{console.log(e)})}e.preventDefault()})}})(k);const w=document.querySelector(".namespace-inbox .inbox-commands .cmd-publish-selected");w&&(e=>{const t=document.querySelector(".namespace-inbox .inbox-commands ul");if(t){const i=t.dataset.href,{namespaceSlug:n}=t.dataset;e.addEventListener("click",e=>{const t=document.querySelectorAll('.namespace-inbox .item input[type="checkbox"]:checked');if(confirm("Do you really want to publish these links?")){const e=[];t.forEach(t=>{e.push(t.value)}),fetch("/api/submitted-link/bulk-publish",{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify({namespaceSlug:n,ids:e})}).then(e=>{window.location.href=i}).catch(e=>{console.log(e)})}e.preventDefault()})}})(w);const y=document.querySelector(".namespace-inbox .inbox-commands .cmd-unpublish-selected");y&&(e=>{const t=document.querySelector(".namespace-inbox .inbox-commands ul");if(t){const i=t.dataset.href,{namespaceSlug:n}=t.dataset;e.addEventListener("click",e=>{const t=document.querySelectorAll('.namespace-inbox .item input[type="checkbox"]:checked');if(confirm("Do you really want to unpublish these links?")){const e=[];t.forEach(t=>{e.push(t.value)}),fetch("/api/submitted-link/bulk-unpublish",{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify({namespaceSlug:n,ids:e})}).then(e=>{window.location.href=i}).catch(e=>{console.log(e)})}e.preventDefault()})}})(y);const b=document.querySelector(".namespace-inbox .inbox-commands .cmd-unpin-selected");b&&(e=>{const t=document.querySelector(".namespace-inbox .inbox-commands ul");if(t){const i=t.dataset.href,{namespaceSlug:n}=t.dataset;e.addEventListener("click",e=>{const t=document.querySelectorAll('.namespace-inbox .item input[type="checkbox"]:checked');if(confirm("Do you really want to unpin these links?")){const e=[];t.forEach(t=>{e.push(t.value)}),fetch("/api/submitted-link/bulk-unpin",{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify({namespaceSlug:n,ids:e})}).then(e=>{window.location.href=i}).catch(e=>{console.log(e)})}e.preventDefault()})}})(b);const v=document.querySelector(".namespace-inbox .inbox-commands .cmd-pin-selected");v&&(e=>{const t=document.querySelector(".namespace-inbox .inbox-commands ul");if(t){const i=t.dataset.href,{namespaceSlug:n}=t.dataset;e.addEventListener("click",e=>{const t=document.querySelectorAll('.namespace-inbox .item input[type="checkbox"]:checked');if(confirm("Do you really want to pin these links?")){const e=[];t.forEach(t=>{e.push(t.value)}),fetch("/api/submitted-link/bulk-pin",{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify({namespaceSlug:n,ids:e})}).then(e=>{window.location.href=i}).catch(e=>{console.log(e)})}e.preventDefault()})}})(v);const S=document.querySelector(".namespace-inbox .inbox-commands .cmd-spam-selected");S&&(e=>{const t=document.querySelector(".namespace-inbox .inbox-commands ul");if(t){const i=t.dataset.href,{namespaceSlug:n}=t.dataset;e.addEventListener("click",e=>{const t=document.querySelectorAll('.namespace-inbox .item input[type="checkbox"]:checked');if(confirm("Do you really want to spam these links?")){const e=[];t.forEach(t=>{e.push(t.value)}),fetch("/api/submitted-link/bulk-spam",{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify({namespaceSlug:n,ids:e})}).then(e=>{window.location.href=i}).catch(e=>{console.log(e)})}e.preventDefault()})}})(S);const f=document.querySelector(".namespace-inbox .inbox-commands .cmd-spam-users-selected");f&&(e=>{const t=document.querySelector(".namespace-inbox .inbox-commands ul");if(t){const i=t.dataset.href,{namespaceSlug:n}=t.dataset;e.addEventListener("click",e=>{const t=document.querySelectorAll('.namespace-inbox .item input[type="checkbox"]:checked');if(confirm("Do you really want to mark these users as spammers?")){const e=[];t.forEach(t=>{e.push(t.value)}),fetch("/api/submitted-link/bulk-spam-users",{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify({namespaceSlug:n,ids:e})}).then(e=>{window.location.href=i}).catch(e=>{console.log(e)})}e.preventDefault()})}})(f);const L=document.querySelector(".namespace-inbox .inbox-commands .cmd-special-empty-all-spam");L&&(e=>{const t=document.querySelector(".namespace-inbox .inbox-commands ul");if(t){const i=t.dataset.href,{namespaceSlug:n}=t.dataset;e.addEventListener("click",e=>{confirm("Do you really want to empty the spam folder and delete all spam submissions?")&&fetch("/api/submitted-link/empty-spam-folder",{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify({namespaceSlug:n})}).then(e=>{window.location.href=i}).catch(e=>{console.log(e)}),e.preventDefault()})}})(L);const D=document.querySelector(".namespace-inbox .inbox-commands .cmd-special-empty-all-new");D&&(e=>{const t=document.querySelector(".namespace-inbox .inbox-commands ul");if(t){const i=t.dataset.href,{namespaceSlug:n}=t.dataset;e.addEventListener("click",e=>{confirm("Do you really want to empty the new folder and delete all new submissions?")&&fetch("/api/submitted-link/empty-new-folder",{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify({namespaceSlug:n})}).then(e=>{window.location.href=i}).catch(e=>{console.log(e)}),e.preventDefault()})}})(D)})(),(()=>{let e;function t(e){const{namespaceSlug:t,term:i}=e.dataset,n=document.querySelector(`.${e.dataset.placeholder} table tbody`),s=document.querySelector(`.${e.dataset.placeholder} table thead`).querySelectorAll("th").length,o=parseInt(e.dataset.size,10),a=parseInt(e.dataset.page,10),r=o*a;e.querySelector("span").style.display="none",e.querySelector("img").style.display="inline-block",fetch(`/render/members?namespaceSlug=${t}&from=${r}&size=${o}&term=${i}`).then(e=>e.json()).then(t=>{if(t&&200===t.status&&t.items&&t.items.length>0)t.items.forEach(i=>{const s=(new DOMParser).parseFromString(i.html,"text/html").querySelector("tr");n.appendChild(s),e.dataset.page=a+1,e.dataset.total=t.total,window.dispatchEvent(new CustomEvent("namespaceMemberRowLoaded",{detail:{hashId:i.itemId}})),e.querySelector("span").style.display="block",e.querySelector("img").style.display="none"});else{n.innerHTML="";const t=document.createElement("tr"),i=document.createElement("td");i.setAttribute("colspan",s),i.innerHTML="No members found, please try searching again",t.appendChild(i),n.appendChild(t),e.style.display="none"}}).catch(t=>{e.style.display="none"})}function i(){const e=document.querySelector(".namespace-members .term-input");if(e){const i=document.querySelector(".namespace-members .load-more-namespace-members");i.dataset.term=e.value,i.dataset.page=0,i.dataset.total=0;document.querySelector(`.${i.dataset.placeholder} table tbody`).innerHTML="",t(i)}}const n=document.querySelector(".namespace-members .term-input");n&&(n.addEventListener("keyup",t=>{clearTimeout(e),e=setTimeout(i,1e3)}),n.addEventListener("keydown",t=>{clearTimeout(e)}),n.addEventListener("search",e=>{const i=document.querySelector(".namespace-members .load-more-namespace-members");i.dataset.term=n.value,i.dataset.page=0,i.dataset.total=0;document.querySelector(`.${i.dataset.placeholder} table tbody`).innerHTML="",t(i)}));const s=document.querySelectorAll(".load-more-namespace-members");s&&s.forEach(e=>{e.addEventListener("click",e=>{t(e.currentTarget)})})})(),(()=>{const e=document.querySelectorAll(".load-more-comments");e&&e.forEach(e=>{const t=e;e.addEventListener("click",i=>{const{status:n,namespaceSlug:s,path:o,placeholder:a,total:r}=e.dataset;let{size:l,page:c}=e.dataset;const m=document.querySelector("."+a);c=parseInt(c,10),l=parseInt(l,10);const d=l*c;t.querySelector("span").style.display="none",t.querySelector("img").style.display="inline-block",fetch(`/render/comments?from=${d}&size=${l}&status=${n}&namespaceSlug=${s}&path=${o}&asTree=false`).then(e=>e.json()).then(e=>{e&&200===e.status&&e.items&&e.items.length>0?e.items.forEach(e=>{const i=(new DOMParser).parseFromString(e.html,"text/html").querySelector(".item");m.appendChild(i),t.dataset.page=c+1,window.dispatchEvent(new CustomEvent("commentLoaded",{detail:{commentId:e.itemId}})),t.querySelector("span").style.display="block",t.querySelector("img").style.display="none"}):t.style.display="none"}).catch(e=>{t.style.display="none"}),(c+1)*l>r&&(t.style.display="none"),i.preventDefault()})})})(),(()=>{const e=document.querySelectorAll(".load-more-stories");e&&e.forEach(e=>{e.addEventListener("click",t=>{const{view:i,userid:n,endpoint:s,extraquery:o}=e.dataset,a=document.querySelector("."+e.dataset.placeholder),r=parseInt(e.dataset.total,10),l=parseInt(e.dataset.size,10),c=parseInt(e.dataset.page,10),m=l*c;e.querySelector("span").style.display="none",e.querySelector("img").style.display="inline-block";let d=`/render/stories?from=${m}&size=${l}&userid=${n}&view=${i}&endpoint=${s}`;o&&(d+="&"+o),fetch(d).then(e=>e.json()).then(t=>{t&&200===t.status&&t.items&&t.items.length>0?t.items.forEach(t=>{const i=(new DOMParser).parseFromString(t.html,"text/html").querySelector("article");a.appendChild(i),e.dataset.page=c+1,window.dispatchEvent(new CustomEvent("storyLoaded",{detail:{storyId:t.itemId}})),e.querySelector("span").style.display="block",e.querySelector("img").style.display="none"}):e.style.display="none"}).catch(t=>{e.style.display="none"}),(c+1)*l>r&&(e.style.display="none")})})})(),(()=>{const e=document.querySelectorAll(".load-more-submitted-links");e&&e.forEach(e=>{const t=e;t.addEventListener("click",e=>{let i="submission";t.classList.contains("load-more-submitted-links--published")?i="published":t.classList.contains("load-more-submitted-links--spam")&&(i="spam");const{namespace:n,placeholder:s,view:o}=t.dataset;let{size:a,total:r,page:l}=t.dataset;const c=document.querySelector("."+s);r=parseInt(r,10),a=parseInt(a,10),l=parseInt(l,10);const m=a*l;t.querySelector("span").style.display="none",t.querySelector("img").style.display="inline-block",fetch(`/render/submitted-links?namespaceSlug=${n}&from=${m}&size=${a}&status=${i}&view=${o}`).then(e=>e.json()).then(e=>{e&&200===e.status&&e.items&&e.items.length>0?e.items.forEach(e=>{const i=(new DOMParser).parseFromString(e.html,"text/html").querySelector("article");c.appendChild(i),t.dataset.page=l+1,window.dispatchEvent(new CustomEvent("submittedLinkLoaded",{detail:{hashId:e.itemId}})),t.querySelector("span").style.display="block",t.querySelector("img").style.display="none"}):t.style.display="none"}).catch(e=>{t.style.display="none"}),(l+1)*a>r&&(t.style.display="none")})})})();const isURL=e=>new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.?)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(e);document.querySelectorAll(".share-story span").forEach(e=>{e.addEventListener("click",e=>{const t=e.target,i=t.dataset.controller,n=t.dataset.type,s=t.parentNode.dataset.id,o=t.parentNode.dataset.title;let a=t.parentNode.dataset.url;switch(isURL(a)||(a=window.location.origin+a),i){case"digg":{let e=t.classList.contains("active")?"remove-digg":"add-digg";fetch(`/api/user-data?method=${e}&id=${s}&type=${n}`).then(e=>e.json()).then((function(e){401==e.status&&openLoginModal(),"add-digg"==e.method?t.classList.add("active"):t.classList.remove("active")}));break}case"save":{let e=t.classList.contains("active")?"remove-save":"add-save";fetch(`/api/user-data?method=${e}&id=${s}&type=${n}`).then(e=>e.json()).then((function(e){401==e.status&&openLoginModal(),"add-save"==e.method?t.classList.add("active"):t.classList.remove("active")}));break}case"twitter":{let e=`https://twitter.com/intent/tweet?url=${encodeURI(a)}&text=${encodeURI(o)}&via=Digg`;window.open(e,window.diggTargetAttribute,"toolbar=no,width=550,height=300");break}case"facebook":{let e=`https://www.facebook.com/dialog/feed?redirect_uri=${encodeURI("https://digg.com")}&link=${encodeURI(a)}&display=popup&app_id=246440939021950`;window.open(e,window.diggTargetAttribute,"toolbar=no,width=550,height=500");break}}})});