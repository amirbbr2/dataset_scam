/*!
 FileReader.js - v0.99
 A lightweight wrapper for common FileReader usage.
 Copyright 2014 Brian Grinstead - MIT License.
 See http://github.com/bgrins/filereader.js for documentation.
 */
(function(m,t){var a=m.FileReader;var k=false;var j="self.addEventListener('message', function(e) { var data=e.data; try { var reader = new FileReaderSync; postMessage({ result: reader[data.readAs](data.file), extra: data.extra, file: data.file})} catch(e){ postMessage({ result:'error', extra:data.extra, file:data.file}); } }, false);";var g="onmessage = function(e) { postMessage(!!FileReaderSync); };";var q=["loadstart","progress","load","abort","error","loadend"];var n=false;var e=m.FileReaderJS={enabled:false,setupInput:p,setupDrop:x,setupClipboard:h,setSync:function(z){n=z;if(n&&!k){d()}},getSync:function(){return n&&k},output:[],opts:{dragClass:"drag",accept:false,readAsDefault:"DataURL",readAsMap:{},on:{loadstart:i,progress:i,load:i,abort:i,error:i,loadend:i,skip:i,groupstart:i,groupend:i,beforestart:i}}};if(typeof(jQuery)!=="undefined"){jQuery.fn.fileReaderJS=function(z){return this.each(function(){if(jQuery(this).is("input")){p(this,z)}else{x(this,z)}})};jQuery.fn.fileClipboard=function(z){return this.each(function(){h(this,z)})}}if(!a){return}function v(B){var z=m.URL||m.webkitURL;var E=m.Blob;var C=m.Worker;if(!z||!E||!C||!B){return null}var A=new E([B]);var D=new C(z.createObjectURL(A));return D}function h(A,B){if(!e.enabled){return}var C=w(w({},e.opts),B);A.addEventListener("paste",z,false);function z(I){var G=[];var K=I.clipboardData||{};var D=K.items||[];for(var F=0;F<D.length;F++){var E=D[F].getAsFile();if(E){var H=new RegExp("/(.*)").exec(E.type);if(!E.name&&H){var J=H[1];E.name="clipboard"+F+"."+J}G.push(E)}}if(G.length){f(I,G,C);I.preventDefault();I.stopPropagation()}}}function p(A,C){if(!e.enabled){return}var D=w(w({},e.opts),C);A.addEventListener("change",B,false);A.addEventListener("drop",z,false);function B(E){f(E,A.files,D)}function z(E){E.stopPropagation();E.preventDefault();f(E,E.dataTransfer.files,D)}}function x(H,z){if(!e.enabled){return}var E=w(w({},e.opts),z);var L=E.dragClass;var K=false;H.addEventListener("dragenter",D(F),false);H.addEventListener("dragleave",D(I),false);H.addEventListener("dragover",D(B),false);H.addEventListener("drop",D(A),false);t.body.addEventListener("dragstart",C,true);t.body.addEventListener("dragend",G,true);t.body.addEventListener("drop",J,false);function G(M){K=false}function C(M){K=true}function J(M){if(M.dataTransfer.files&&M.dataTransfer.files.length){M.stopPropagation();M.preventDefault()}}function D(M){return function(){if(!K){M.apply(this,arguments)}}}function A(M){M.stopPropagation();M.preventDefault();if(L){r(H,L)}f(M,M.dataTransfer.files,E)}function F(M){M.stopPropagation();M.preventDefault();if(L){o(H,L)}}function I(M){if(L){r(H,L)}}function B(M){M.stopPropagation();M.preventDefault();if(L){o(H,L)}}}function s(C,z){for(var B=0;B<C.length;B++){var A=C[B];A.extra={nameNoExtension:A.name.substring(0,A.name.lastIndexOf(".")),extension:A.name.substring(A.name.lastIndexOf(".")+1),fileID:B,uniqueID:c(),groupID:z,prettySize:u(A.size)}}}function y(A,C,z){for(var B in C){if(A.match(new RegExp(B))){return"readAs"+C[B]}}return"readAs"+z}function f(G,A,z){var F=A.length;var H={groupID:l(),files:A,started:new Date()};function E(){H.ended=new Date();z.on.groupend(H)}function D(){if(--F===0){E()}}e.output.push(H);s(A,H.groupID);z.on.groupstart(H);if(!A.length){E();return}var C=n&&k;var B;if(C){B=v(j);B.onmessage=function(K){var J=K.data.file;var I=K.data.result;if(!J.extra){J.extra=K.data.extra}J.extra.ended=new Date();z.on[I==="error"?"error":"load"]({target:{result:I}},J);D()}}Array.prototype.forEach.call(A,function(K){K.extra.started=new Date();if(z.accept&&!K.type.match(new RegExp(z.accept))){z.on.skip(K);D();return}if(z.on.beforestart(K)===false){z.on.skip(K);D();return}var J=y(K.type,z.readAsMap,z.readAsDefault);if(B){B.postMessage({file:K,extra:K.extra,readAs:J})}else{var I=new a();I.originalEvent=G;q.forEach(function(L){I["on"+L]=function(M){if(L=="load"||L=="error"){K.extra.ended=new Date()}z.on[L](M,K);if(L=="loadend"){D()}}});I[J](K)}})}function d(){var z=v(g);if(z){z.onmessage=function(A){k=A.data};z.postMessage({})}}function i(){}function w(z,B){for(var A in B){if(B[A]&&B[A].constructor&&B[A].constructor===Object){z[A]=z[A]||{};arguments.callee(z[A],B[A])}else{z[A]=B[A]}}return z}function b(A,z){return new RegExp("(?:^|\\s+)"+z+"(?:\\s+|$)").test(A.className)}function o(A,z){if(!b(A,z)){A.className=A.className?[A.className,z].join(" "):z}}function r(A,z){if(b(A,z)){var B=A.className;A.className=B.replace(new RegExp("(?:^|\\s+)"+z+"(?:\\s+|$)","g")," ").replace(/^\s\s*/,"").replace(/\s\s*$/,"")}}function u(z){var A=["bytes","kb","MB","GB","TB","PB"];var B=Math.floor(Math.log(z)/Math.log(1024));return(z/Math.pow(1024,Math.floor(B))).toFixed(2)+" "+A[B]}var l=(function(z){return function(){return z++}})(0);var c=(function(z){return function(){return z++}})(0);e.enabled=true})(this,document);